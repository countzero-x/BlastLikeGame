{"version":3,"sources":["assets/scripts/game/BlastGame.ts","assets/scripts/game/views/BoardView.ts","assets/scripts/game/mechanics/Board.ts","assets/scripts/game/mechanics/boosters/BombBooster.ts","assets/scripts/game/enums/BoosterType.ts","assets/scripts/game/views/BoosterView.ts","assets/scripts/game/mechanics/Boosters.ts","assets/scripts/game/Bootstrap.ts","assets/scripts/game/mechanics/effects/DestroyEffect.ts","assets/scripts/GameEvent.ts","assets/scripts/game/enums/GameState.ts","assets/scripts/game/views/GameViewController.ts","assets/scripts/game/mechanics/effects/GravityEffect.ts","assets/scripts/game/mechanics/Gravity.ts","assets/scripts/game/enums/InputState.ts","assets/scripts/game/mechanics/Input.ts","assets/scripts/game/mechanics/superTiles/LineSuperTileLogic.ts","assets/scripts/game/mechanics/effects/LoseEffect.ts","assets/scripts/game/views/LoseView.ts","assets/scripts/game/mechanics/Matches.ts","assets/scripts/game/mechanics/superTiles/MaxBombSuperTileLogic.ts","assets/scripts/game/views/MovesView.ts","assets/scripts/game/mechanics/Moves.ts","assets/scripts/game/NormalClickProcessor.ts","assets/scripts/game/views/OverlayView.ts","assets/scripts/game/mechanics/superTiles/RadiusBombSuperTileLogic.ts","assets/scripts/game/views/ScoreView.ts","assets/scripts/game/mechanics/Score.ts","assets/scripts/game/mechanics/effects/ShakeEffect.ts","assets/scripts/game/mechanics/effects/ShuffleEffect.ts","assets/scripts/game/mechanics/Shuffle.ts","assets/scripts/game/mechanics/Spawner.ts","assets/scripts/game/mechanics/superTiles/SuperTileFactory.ts","assets/scripts/game/mechanics/effects/SuperTileSpawnEffect.ts","assets/scripts/game/mechanics/superTiles/SuperTileType.ts","assets/scripts/game/mechanics/superTiles/SuperTiles.ts","assets/scripts/game/mechanics/superTiles/SuperTile.ts","assets/scripts/game/mechanics/effects/SwapEffect.ts","assets/scripts/game/mechanics/boosters/TeleportBooster.ts","assets/scripts/game/enums/TileColor.ts","assets/scripts/game/mechanics/effects/TileSpawnEffect.ts","assets/scripts/game/views/TileViewPool.ts","assets/scripts/game/views/TileView.ts","assets/scripts/game/Tile.ts","assets/scripts/game/mechanics/effects/WinEffect.ts","assets/scripts/game/views/WinView.ts"],"names":["GameEvent_1","require","GameState_1","InputState_1","BlastGame","input","board","score","moves","spawner","shuffle","matches","gravity","superTiles","boosters","preGameProcessors","postGameProcessors","preProcessors","clickProcessors","postProcessors","tileRemovedProcessors","this","onStateChanged","GameEvent","onInputStateChanged","onTurnFinished","onGameStarted","onGameFinished","_state","GameState","GAME","_inputState","InputState","NORMAL","_lastTurnContext","createTurnCtx","_preGameProcessors","_postGameProcessors","_preTurnProcessors","_clickProcessors","_postTurnProcessors","_tileRemovedProcessors","init","Object","defineProperty","prototype","get","getState","getInputState","setInputState","state","invoke","start","effects","Array","_i","_a","length","preGameProc","push","onPreGame","onTileClicked","subscribe","processTurn","finish","unsubscribe","postGameProc","onPostGame","reset","pos","isEnabled","tile","getTile","x","y","isEmpty","selectedTile","preTurnProc","canProcess","onPreTurn","_b","_c","clickProcessor","onTileClick","_d","_e","from","tilesToRemove","deletedTile","removeTile","_f","_g","tileDeteledProcessor","onTileRemoved","_h","_j","postProcessor","onPostTurn","clear","setState","bind","initialRemovedCount","Set","tilesToCreate","exports","cc","_decorator","ccclass","property","BoardView","_super","__extends","_this","apply","arguments","_tileViews","tileViewPool","tileSize","tileSpacing","_tileViewPool","_board","_input","_tileSize","_tileSpacing","width","height","onEnable","clickNode","on","Node","EventType","TOUCH_END","onTouch","onDisable","off","getTileView","put","event","touchPos","getLocation","gridPos","worldToGridPos","log","color","isValidPosition","invokeTileClick","createTileView","view","node","position","gridToWorldPos","tiles","addChild","startX","startY","v3","worldPos","localPos","convertToNodeSpaceAR","Math","floor","animateTileRemoval","Promise","resolve","completed","duration","_loop_1","tileView","runAction","sequence","spawn","scaleTo","fadeOut","callFunc","tiles_1","animateSuperTileCreation","superTile","scale","fadeIn","easing","easeBackOut","animateGravity","movements","forEach","move","fromY","updatedTile","toY","newWorldPos","moveTo","easeIn","animateHideTiles","centerX","centerY","distance","abs","delay","delayTime","rotateBy","animateNewTiles","newTiles","newTiles_1","finalPos","startPos","opacity","v2","easeBounceOut","animateTileSwap","left","right","tileView1","tileView2","onComplete","newPos","easeOut","animateShuffle","totalTiles","row","row_1","tile_1","rotation","allTileViews_2","completedAppear_1","appearDuration","allTileViews_1","randomDelay","random","__decorate","Component","Board","Map","getKey","setTile","validatePosition","set","swapTiles","tileA","tileB","posA","posB","setPosition","removeTiles","removeTileByPosition","delete","hasTile","has","getAllTiles","values","Error","BoosterType_1","DestroyEffect_1","BombBooster","count","radius","type","BoosterType","BOMB","initialInputState","onCountChanged","_maxCount","_radius","_count","ctx","canUse","getBombAffectedTiles","add","setCount","result","DestroyEffect","getCount","radiusSq","dx","dy","distanceSq","value","BoosterView","_type","_boosters","_booster","getBooster","handleCountChanged","onSelectedTypeChanged","handleTypeChanged","button","selectedType","NONE","canApply","label","string","toString","interactable","animateBoosterActive","active","Color","YELLOW","WHITE","stopAllActions","tintTo","r","g","b","repeatForever","Label","Button","Boosters","_selectedType","game","_game","handleInputStateChanged","booster","register","TELEPORT_PHASE_ONE","TELEPORT_PHASE_TWO","TELEPORT","BoardView_1","BoosterView_1","LoseView_1","MovesView_1","ScoreView_1","WinView_1","BlastGame_1","OverlayView_1","TileViewPool_1","Board_1","Boosters_1","Gravity_1","Matches_1","Moves_1","Score_1","Shuffle_1","Spawner_1","SuperTiles_1","BombBooster_1","TeleportBooster_1","TileColor_1","SuperTileType_1","LineSuperTileLogic_1","RadiusBombSuperTileLogic_1","MaxBombSuperTileLogic_1","Input_1","GameViewController_1","NormalClickProcessor_1","Bootstrap","boardWidth","boardHeight","scorePerTile","targetScore","maxMoves","maxShuffles","superTileRemovedCountForLine","superTileRemovedCountForLineRadiusBomb","superTileRemovedCountForMaxBomb","superTileBombRadius","boosterBombCount","boosterBombRadius","boosterTeleportCount","onLoad","TeleportBooster","SuperTiles","LineSuperTileLogic","RadiusBombSuperTileLogic","MaxBombSuperTileLogic","Spawner","TileColor","RED","BLUE","GREEN","PURPLE","Score","Moves","Shuffle","Matches","Gravity","Input","preTurnProcessors","turnClickProcessors","NormalClickProcessor","postTurnProcessors","scoreView","movesView","winView","loseView","bombView","teleportView","TileViewPool","tilePrefab","registerRegularTile","redTileSprite","blueTileSprite","greenTileSprite","yellowTileSprite","purpleTileSprite","registerSuperTile","SuperTileType","HORIZONTAL","horizontalTileSprite","VERTICAL","verticalTileSprite","RADIUS_BOMB","radiusBombTileSprite","MAX_BOMB","maxBombTileSprite","boardView","gameView","GameViewController","overlayView","ScoreView","MovesView","WinView","LoseView","OverlayView","Prefab","SpriteFrame","_handlers","_onceHandlers","action","caller","find","handler","same","subscribeOnce","handlerIndex","findIndex","splice","onceHandlerIndex","unsubscribeAll","arg","handlers","__spreadArrays","i","call","onceHandlers","GravityEffect_1","LoseEffect_1","ShakeEffect_1","ShuffleEffect_1","SuperTileSpawnEffect_1","SwapEffect_1","TileSpawnEffect_1","WinEffect_1","boosterViews","_boosterViewsMap","_boardView","_boosterViews","_loseView","_winView","_movesView","_scoreView","_overlayView","processEffects","item","hide","enable","updateScore","updateMoves","disable","effects_1","effect","sent","SuperTileSpawnEffect","TileSpawnEffect","tilesToSpawn","GravityEffect","ShuffleEffect","ShakeEffect","tileToShake","animateShake","SwapEffect","WinEffect","show","LoseEffect","Tile_1","applyGravity","moveHistory","oldY","newY","Tile","EMPTY","_enabled","SuperTile_1","isHorizontal","canProcessTile","SuperTile","activate","range","coord1","coord2","animated","panelLose","hasAvailableMatches","hasSuperTile","visited","index","group","getAvaliableMatch","t","tileIndex","startTile","fill","queue","targetColor","directions","shift","cx","cy","directions_1","_moves","_currentDisplayMoves","currentMoves","oldMoves","newMoves","difference","stopActionByTag","visualAction","setTag","onMovesChanged","_currentMoves","decrementMove","hasMovesLeft","WIN","match","shakeEffect","toRemove","toRemove_1","destroyEffect","_currentOpacity","ovelay","fadeTo","bombRadius","_bombRadius","sqrt","_score","_currentDisplayScore","currentScore","oldScore","newScore","steps","increment","currentStep","counterAction","repeat","combinedAction","onScoreChanged","_currentScore","addScore","calculateScore","size","hasReachedTarget","tilesCount","points","maxAttempts","_attempts","shuffled","shuffleAvaliable","tilesToShuffle","allTiles","j","avaliableColors","toSpawn","fillWithRegularTiles","toSpawn_1","spawnEffect","toSpawn_2","tilesUpdated","createRandomRegularTile","createSuperTile","SPECIAL","createRegularTile","SuperTileFactory","_thresholds","threshold","getType","tilesRemoved","available","filter","SuperTileFactory_1","_logics","_typeFactory","logic","superType","getSuperTileType","_firstTile","TileView_1","regularTilesSprites","superTilesSprites","sprite","prefab","preinstantiatedCount","pool","NodePool","TILES_POOL_NAME","instantiate","terminate","getComponent","default","setSpriteFrame","TileView","spriteFrame","getPosition","originalPos","clone","shakeDistance","shakeSpeed","shakeAction","moveBy","Sprite","panelWin"],"mappings":"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","sourcesContent":["import { GameEvent } from \"../GameEvent\";\r\nimport { GameState } from \"./enums/GameState\";\r\nimport { InputState } from \"./enums/InputState\";\r\nimport { Board, TurnEffect } from \"./mechanics/Board\";\r\nimport { Boosters } from \"./mechanics/Boosters\";\r\nimport { Gravity } from \"./mechanics/Gravity\";\r\nimport { Input } from \"./mechanics/Input\";\r\nimport { Matches } from \"./mechanics/Matches\";\r\nimport { Moves } from \"./mechanics/Moves\";\r\nimport { Score } from \"./mechanics/Score\";\r\nimport { Shuffle } from \"./mechanics/Shuffle\";\r\nimport { Spawner } from \"./mechanics/Spawner\";\r\nimport { SuperTiles } from \"./mechanics/superTiles/SuperTiles\";\r\nimport { Tile } from \"./Tile\";\r\nimport { TurnContext } from \"./TurnContext\";\r\nimport { PostGameProcessor, PostTurnProcessor, PreGameProcessor, PreTurnProcessor, TileDeletedProcessor, TurnClickProcessor } from \"./TurnProcessor\";\r\n\r\nexport class BlastGame {\r\n    public readonly input: Input;\r\n    public readonly board: Board;\r\n    public readonly score: Score;\r\n    public readonly moves: Moves;\r\n    public readonly spawner: Spawner;\r\n    public readonly shuffle: Shuffle;\r\n    public readonly matches: Matches;\r\n    public readonly gravity: Gravity;\r\n    public readonly superTiles: SuperTiles;\r\n    public readonly boosters: Boosters;\r\n\r\n    public readonly onStateChanged = new GameEvent<GameState>();\r\n    public readonly onInputStateChanged = new GameEvent<InputState>();\r\n    public readonly onTurnFinished = new GameEvent<Array<TurnEffect>>();\r\n    public readonly onGameStarted = new GameEvent<Array<TurnEffect>>();\r\n    public readonly onGameFinished = new GameEvent<Array<TurnEffect>>();\r\n\r\n    private _state: GameState = GameState.GAME;\r\n    private _inputState: InputState = InputState.NORMAL;\r\n    private _lastTurnContext: TurnContext;\r\n\r\n    private _preGameProcessors: Array<PreGameProcessor>;\r\n    private _postGameProcessors: Array<PostGameProcessor>\r\n    private _preTurnProcessors: Array<PreTurnProcessor>;\r\n    private _clickProcessors: Array<TurnClickProcessor>;\r\n    private _postTurnProcessors: Array<PostTurnProcessor>;\r\n    private _tileRemovedProcessors: Array<TileDeletedProcessor>;\r\n\r\n    constructor(\r\n        input: Input,\r\n        board: Board,\r\n        score: Score,\r\n        moves: Moves,\r\n        spawner: Spawner,\r\n        shuffle: Shuffle,\r\n        matches: Matches,\r\n        gravity: Gravity,\r\n        superTiles: SuperTiles,\r\n        boosters: Boosters,\r\n        preGameProcessors: Array<PreGameProcessor>,\r\n        postGameProcessors: Array<PostGameProcessor>,\r\n        preProcessors: Array<PreTurnProcessor>,\r\n        clickProcessors: Array<TurnClickProcessor>,\r\n        postProcessors: Array<PostTurnProcessor>,\r\n        tileRemovedProcessors: Array<TileDeletedProcessor>,\r\n    ) {\r\n        this.input = input;\r\n        this.board = board;\r\n        this.score = score;\r\n        this.moves = moves;\r\n        this.spawner = spawner;\r\n        this.shuffle = shuffle;\r\n        this.matches = matches;\r\n        this.gravity = gravity;\r\n        this.superTiles = superTiles;\r\n        this.boosters = boosters;\r\n\r\n        this._lastTurnContext = this.createTurnCtx();\r\n\r\n        this._preGameProcessors = preGameProcessors;\r\n        this._postGameProcessors = postGameProcessors;\r\n        this._preTurnProcessors = preProcessors;\r\n        this._clickProcessors = clickProcessors;\r\n        this._postTurnProcessors = postProcessors;\r\n        this._tileRemovedProcessors = tileRemovedProcessors;\r\n\r\n        this.boosters.init(this);\r\n    }\r\n\r\n    public get lastTurnContext(): TurnContext {\r\n        return this._lastTurnContext;\r\n    }\r\n\r\n    public getState(): GameState {\r\n        return this._state;\r\n    }\r\n\r\n    public getInputState(): InputState {\r\n        return this._inputState;\r\n    }\r\n\r\n    public setInputState(state: InputState) {\r\n        this._inputState = state;\r\n        this.onInputStateChanged.invoke(this._inputState);\r\n    }\r\n\r\n    public start() {\r\n        const effects = new Array<TurnEffect>();\r\n        for (var preGameProc of this._preGameProcessors) {\r\n            effects.push(preGameProc.onPreGame(this));\r\n        }\r\n        this.onGameStarted.invoke(effects);\r\n\r\n        this.input.onTileClicked.subscribe(this.processTurn, this);\r\n    }\r\n\r\n    public finish() {\r\n        this.input.onTileClicked.unsubscribe(this.processTurn, this);\r\n\r\n        const effects = new Array<TurnEffect>();\r\n        for (var postGameProc of this._postGameProcessors) {\r\n            effects.push(postGameProc.onPostGame(this));\r\n        }\r\n        this.onGameFinished.invoke(effects);\r\n\r\n        this.reset();\r\n    }\r\n\r\n    public processTurn(pos: { x: number, y: number }): Array<TurnEffect> {\r\n        if (!this.input.isEnabled) {\r\n            return;\r\n        }\r\n\r\n        this._lastTurnContext = this.createTurnCtx();\r\n\r\n        const tile = this.board.getTile(pos.x, pos.y);\r\n        if (!tile || tile.isEmpty) {\r\n            return;\r\n        }\r\n\r\n        this._lastTurnContext.selectedTile = tile;\r\n\r\n        const effects = new Array<TurnEffect>();\r\n        for (var preTurnProc of this._preTurnProcessors) {\r\n            if (preTurnProc.canProcess(this._lastTurnContext)) {\r\n                effects.push(preTurnProc.onPreTurn(this._lastTurnContext));\r\n            }\r\n        }\r\n\r\n        for (var clickProcessor of this._clickProcessors) {\r\n            if (clickProcessor.canProcess(this._lastTurnContext)) {\r\n                effects.push(clickProcessor.onTileClick(this._lastTurnContext));\r\n            }\r\n        }\r\n\r\n        for (var deletedTile of Array.from(this._lastTurnContext.tilesToRemove)) {\r\n            this.board.removeTile(deletedTile);\r\n        }\r\n\r\n        for (var tileDeteledProcessor of this._tileRemovedProcessors) {\r\n            if (tileDeteledProcessor.canProcess(this._lastTurnContext)) {\r\n                effects.push(tileDeteledProcessor.onTileRemoved(this._lastTurnContext));\r\n            }\r\n        }\r\n\r\n        for (var postProcessor of this._postTurnProcessors) {\r\n            if (postProcessor.canProcess(this._lastTurnContext)) {\r\n                effects.push(postProcessor.onPostTurn(this._lastTurnContext));\r\n            }\r\n        }\r\n\r\n        this.onTurnFinished.invoke(effects);\r\n    }\r\n\r\n    private reset() {\r\n        this.setInputState(InputState.NORMAL);\r\n        this._lastTurnContext = null;\r\n        this.score.reset();\r\n        this.moves.reset();\r\n        this.boosters.reset();\r\n        this.board.clear();\r\n    }\r\n\r\n    private setState(state: GameState) {\r\n        this._state = state;\r\n        this.onStateChanged.invoke(this._state);\r\n    }\r\n\r\n    private createTurnCtx(): TurnContext {\r\n        return {\r\n            getState: this.getState.bind(this),\r\n            setState: this.setState.bind(this),\r\n            getInputState: this.getInputState.bind(this),\r\n            setInputState: this.setInputState.bind(this),\r\n            selectedTile: null,\r\n            spawner: this.spawner,\r\n            board: this.board,\r\n            matches: this.matches,\r\n            initialRemovedCount: 0,\r\n            tilesToRemove: new Set<Tile>(),\r\n            tilesToCreate: new Set<Tile>()\r\n        };\r\n    }\r\n}\r\n","import { Board } from \"../mechanics/Board\";\r\nimport { TileMove } from \"../mechanics/Gravity\";\r\nimport { Input } from \"../mechanics/Input\";\r\nimport { SuperTile } from \"../mechanics/superTiles/SuperTile\";\r\nimport { Tile } from \"../Tile\";\r\nimport TileView from \"./TileView\";\r\nimport { TileViewPool } from \"./TileViewPool\";\r\n\r\nconst { ccclass, property } = cc._decorator;\r\n\r\n@ccclass\r\nexport class BoardView extends cc.Component {\r\n\r\n    @property(cc.Node)\r\n    private tiles: cc.Node\r\n\r\n    @property(cc.Node)\r\n    private clickNode: cc.Node\r\n\r\n    private _board: Board;\r\n    private _input: Input;\r\n    private _tileSize: number;\r\n    private _tileSpacing: number;\r\n    private _tileViews: TileView[][] = [];\r\n    private _tileViewPool: TileViewPool;\r\n\r\n    public init(board: Board, input: Input, tileViewPool: TileViewPool, tileSize: number, tileSpacing: number) {\r\n        this._tileViewPool = tileViewPool;\r\n        this._board = board;\r\n        this._input = input;\r\n        this._tileSize = tileSize;\r\n        this._tileSpacing = tileSpacing;\r\n\r\n        for (let x = 0; x < this._board.width; x++) {\r\n            this._tileViews[x] = [];\r\n            for (let y = 0; y < this._board.height; y++) {\r\n                this._tileViews[x][y] = null;\r\n            }\r\n        }\r\n    }\r\n\r\n    protected onEnable(): void {\r\n        this.clickNode.on(cc.Node.EventType.TOUCH_END, this.onTouch, this);\r\n    }\r\n\r\n    protected onDisable(): void {\r\n        this.clickNode.off(cc.Node.EventType.TOUCH_END, this.onTouch, this);\r\n    }\r\n\r\n    public getTileView(x: number, y: number): TileView | null {\r\n        if (x >= 0 && x < this._board.width && y >= 0 && y < this._board.height) {\r\n            return this._tileViews[x][y];\r\n        }\r\n        return null;\r\n    }\r\n\r\n    public reset() {\r\n        for (let x = 0; x < this._board.width; x++) {\r\n            this._tileViews[x] = [];\r\n            for (let y = 0; y < this._board.height; y++) {\r\n                if (this._tileViews[x][y] != null) {\r\n                    this._tileViewPool.put(this._tileViews[x][y]);\r\n                }\r\n                this._tileViews[x][y] = null;\r\n            }\r\n        }\r\n    }\r\n\r\n    private onTouch(event: cc.Event.EventTouch): void {\r\n        const touchPos = event.getLocation();\r\n        const gridPos = this.worldToGridPos(touchPos);\r\n\r\n        cc.log(`   : (${touchPos.x}, ${touchPos.y})`);\r\n        cc.log(`  : (${gridPos.x}, ${gridPos.y})`);\r\n\r\n        const tile = this._board.getTile(gridPos.x, gridPos.y);\r\n        if (tile) {\r\n            cc.log(` : =${tile.color}, isEmpty=${tile.isEmpty}`);\r\n        } else {\r\n            cc.log(`   ( )`);\r\n        }\r\n\r\n        if (this.isValidPosition(gridPos.x, gridPos.y)) {\r\n            this._input.invokeTileClick({ x: gridPos.x, y: gridPos.y });\r\n        }\r\n    }\r\n\r\n    private isValidPosition(x: number, y: number): boolean {\r\n        return x >= 0 && x < this._board.width && y >= 0 && y < this._board.height;\r\n    }\r\n\r\n    // :   null   \r\n    private createTileView(tile: Tile): TileView | null {\r\n        if (tile == null) {\r\n            return null;\r\n        }\r\n\r\n        const view = this._tileViewPool.get(tile);\r\n        view.node.position = this.gridToWorldPos(tile.x, tile.y);\r\n\r\n        this.tiles.addChild(view.node);\r\n        return view;\r\n    }\r\n\r\n    private gridToWorldPos(x: number, y: number): cc.Vec3 {\r\n        const startX = -(this._board.width * (this._tileSize + this._tileSpacing)) / 2 + this._tileSize / 2;\r\n        const startY = -(this._board.height * (this._tileSize + this._tileSpacing)) / 2 + this._tileSize / 2;\r\n\r\n        return cc.v3(\r\n            startX + x * (this._tileSize + this._tileSpacing),\r\n            startY + y * (this._tileSize + this._tileSpacing),\r\n            0\r\n        );\r\n    }\r\n\r\n    // :  | null   , ..   \r\n    private worldToGridPos(worldPos: cc.Vec2): { x: number, y: number } {\r\n        const localPos = this.tiles.convertToNodeSpaceAR(worldPos);\r\n\r\n        const startX = -(this._board.width * (this._tileSize + this._tileSpacing)) / 2 + this._tileSize / 2;\r\n        const startY = -(this._board.height * (this._tileSize + this._tileSpacing)) / 2 + this._tileSize / 2;\r\n\r\n        const x = Math.floor((localPos.x - startX + this._tileSize / 2) / (this._tileSize + this._tileSpacing));\r\n        const y = Math.floor((localPos.y - startY + this._tileSize / 2) / (this._tileSize + this._tileSpacing));\r\n\r\n        return { x, y };\r\n    }\r\n\r\n    public animateTileRemoval(tiles: Tile[]): Promise<void> {\r\n        return new Promise<void>((resolve) => {\r\n            if (tiles.length === 0) {\r\n                resolve();\r\n                return;\r\n            }\r\n\r\n            let completed = 0;\r\n            const duration = 0.3;\r\n\r\n            for (const tile of tiles) {\r\n                const tileView = this.getTileView(tile.x, tile.y);\r\n                if (tileView) {\r\n                    tileView.node.runAction(\r\n                        cc.sequence(\r\n                            cc.spawn(\r\n                                cc.scaleTo(duration, 0),\r\n                                cc.fadeOut(duration)\r\n                            ),\r\n                            cc.callFunc(() => {\r\n                                this._tileViews[tile.x][tile.y] = null;\r\n                                this._tileViewPool.put(tileView);\r\n\r\n                                completed++;\r\n                                if (completed === tiles.length) {\r\n                                    resolve();\r\n                                }\r\n                            })\r\n                        )\r\n                    );\r\n                } else {\r\n                    completed++;\r\n                    if (completed === tiles.length) {\r\n                        resolve();\r\n                    }\r\n                }\r\n            }\r\n        });\r\n    }\r\n\r\n    public animateSuperTileCreation(superTile: SuperTile | null): Promise<void> {\r\n        return new Promise<void>((resolve) => {\r\n            if (!superTile) {\r\n                resolve();\r\n                return;\r\n            }\r\n\r\n            const x = superTile.x;\r\n            const y = superTile.y;\r\n\r\n            const tileView = this.createTileView(superTile);\r\n            this._tileViews[x][y] = tileView;\r\n\r\n            if (!tileView) {\r\n                resolve();\r\n                return;\r\n            }\r\n\r\n            tileView.node.scale = 0;\r\n\r\n            const duration = 0.4;\r\n            tileView.node.runAction(\r\n                cc.sequence(\r\n                    cc.spawn(\r\n                        cc.fadeIn(duration * 0.3),\r\n                        cc.scaleTo(duration * 0.3, 1).easing(cc.easeBackOut())\r\n                    ),\r\n                    cc.callFunc(() => {\r\n                        resolve();\r\n                    })\r\n                )\r\n            );\r\n        });\r\n    }\r\n\r\n    public animateGravity(movements: TileMove[]): Promise<void> {\r\n        return new Promise<void>((resolve) => {\r\n            if (!movements || movements.length === 0) {\r\n                resolve();\r\n                return;\r\n            }\r\n\r\n            let completed = 0;\r\n            const duration = 0.1;\r\n\r\n            movements.forEach((move) => {\r\n                const tileView = this._tileViews[move.x][move.fromY];\r\n\r\n                if (tileView) {\r\n                    this._tileViews[move.x][move.fromY] = null;\r\n\r\n                    const updatedTile = this._board.getTile(move.x, move.toY);\r\n                    if (updatedTile) {\r\n                        this._tileViews[move.x][move.toY] = tileView;\r\n                        cc.log(`    tile TileView: (${updatedTile.x}, ${updatedTile.y})`);\r\n                    }\r\n\r\n                    //    \r\n                    const newWorldPos = this.gridToWorldPos(move.x, move.toY);\r\n\r\n                    //   \r\n                    tileView.node.runAction(\r\n                        cc.sequence(\r\n                            cc.moveTo(duration, newWorldPos.x, newWorldPos.y).easing(cc.easeIn(2)),\r\n                            cc.callFunc(() => {\r\n                                completed++;\r\n                                if (completed === movements.length) {\r\n                                    resolve();\r\n                                }\r\n                            })\r\n                        )\r\n                    );\r\n                } else {\r\n                    completed++;\r\n                    if (completed === movements.length) {\r\n                        resolve();\r\n                    }\r\n                }\r\n            });\r\n        });\r\n    }\r\n\r\n    public animateHideTiles(): Promise<void> {\r\n        return new Promise<void>((resolve) => {\r\n            if (this._tileViews.length === 0) {\r\n                resolve();\r\n                return;\r\n            }\r\n\r\n            let completed = 0;\r\n            const duration = 0.4;\r\n\r\n            const centerX = Math.floor(this._board.width / 2);\r\n            const centerY = Math.floor(this._board.height / 2);\r\n\r\n            for (let x = 0; x < this._board.width; x++) {\r\n                for (let y = 0; y < this._board.height; y++) {\r\n                    const tileView = this.getTileView(x, y);\r\n                    if (tileView) {\r\n                        //   \r\n                        const distance = Math.abs(x - centerX) + Math.abs(y - centerY);\r\n                        const delay = distance * 0.05;\r\n\r\n                        tileView.node.runAction(\r\n                            cc.sequence(\r\n                                cc.delayTime(delay),\r\n                                cc.spawn(\r\n                                    cc.scaleTo(duration, 0).easing(cc.easeIn(2)),\r\n                                    cc.fadeOut(duration),\r\n                                    cc.rotateBy(duration, 180)\r\n                                ),\r\n                                cc.callFunc(() => {\r\n                                    completed++;\r\n                                    if (completed == this._tileViews.length) {\r\n                                        resolve();\r\n                                    }\r\n                                })\r\n                            )\r\n                        );\r\n                    }\r\n                }\r\n            }\r\n        });\r\n    }\r\n\r\n\r\n    public animateNewTiles(newTiles: Tile[]): Promise<void> {\r\n        return new Promise<void>((resolve) => {\r\n            if (newTiles.length === 0) {\r\n                resolve();\r\n                return;\r\n            }\r\n\r\n            let completed = 0;\r\n            const duration = 0.4;\r\n\r\n            for (const tile of newTiles) {\r\n                const tileView = this.createTileView(tile);\r\n                this._tileViews[tile.x][tile.y] = tileView;\r\n\r\n                // :    null\r\n                if (!tileView) {\r\n                    completed++;\r\n                    if (completed === newTiles.length) {\r\n                        resolve();\r\n                    }\r\n                    continue;\r\n                }\r\n\r\n                const finalPos = this.gridToWorldPos(tile.x, tile.y);\r\n                const startPos = cc.v3(\r\n                    finalPos.x,\r\n                    finalPos.y + (this._board.height * (this._tileSize + this._tileSpacing))\r\n                );\r\n\r\n                tileView.node.position = startPos;\r\n                tileView.node.opacity = 0;\r\n\r\n                tileView.node.runAction(\r\n                    cc.sequence(\r\n                        cc.spawn(\r\n                            cc.moveTo(duration, cc.v2(finalPos)).easing(cc.easeBounceOut()),\r\n                            cc.fadeIn(duration * 0.3),\r\n                            cc.scaleTo(duration * 0.3, 1)\r\n                        ),\r\n                        cc.callFunc(() => {\r\n                            completed++;\r\n                            if (completed === newTiles.length) {\r\n                                resolve();\r\n                            }\r\n                        })\r\n                    )\r\n                );\r\n            }\r\n        });\r\n    }\r\n\r\n    public animateTileSwap(left: Tile, right: Tile): Promise<void> {\r\n        return new Promise((resolve) => {\r\n            const tileView1 = this.getTileView(left.x, left.y);\r\n            const tileView2 = this.getTileView(right.x, right.y);\r\n\r\n            if (!tileView1 || !tileView2) {\r\n                resolve();\r\n                return;\r\n            }\r\n\r\n            const duration = 0.3;\r\n            let completed = 0;\r\n\r\n            const onComplete = () => {\r\n                completed++;\r\n                if (completed === 2) {\r\n                    resolve();\r\n                }\r\n            };\r\n\r\n            tileView1.node.runAction(\r\n                cc.sequence(\r\n                    cc.scaleTo(duration / 2, 0).easing(cc.easeIn(2)),\r\n                    cc.callFunc(() => {\r\n                        const newPos = this.gridToWorldPos(right.x, right.y);\r\n                        tileView1.node.position = newPos;\r\n                        this._tileViews[right.x][right.y] = tileView1;\r\n                    }),\r\n                    cc.scaleTo(duration / 2, 1.0).easing(cc.easeOut(2)),\r\n                    cc.callFunc(onComplete)\r\n                )\r\n            );\r\n\r\n            tileView2.node.runAction(\r\n                cc.sequence(\r\n                    cc.scaleTo(duration / 2, 0).easing(cc.easeIn(2)),\r\n                    cc.callFunc(() => {\r\n                        const newPos = this.gridToWorldPos(left.x, left.y);\r\n                        tileView2.node.position = newPos;\r\n                        this._tileViews[left.x][left.y] = tileView2;\r\n                    }),\r\n                    cc.scaleTo(duration / 2, 1.0).easing(cc.easeOut(2)),\r\n                    cc.callFunc(onComplete)\r\n                )\r\n            );\r\n        });\r\n    }\r\n\r\n    public animateShuffle(): Promise<void> {\r\n        return new Promise<void>((resolve) => {\r\n            if (this._tileViews.length === 0) {\r\n                resolve();\r\n                return;\r\n            }\r\n\r\n            const duration = 0.5;\r\n            let completed = 0;\r\n\r\n            // :    \r\n            let totalTiles = 0;\r\n            for (const row of this._tileViews) {\r\n                totalTiles += row.length;\r\n            }\r\n\r\n            for (const row of this._tileViews) {\r\n                for (const tile of row) {\r\n                    // :    null\r\n                    if (!tile) {\r\n                        completed++;\r\n                        continue;\r\n                    }\r\n\r\n                    tile.node.runAction(\r\n                        cc.sequence(\r\n                            cc.spawn(\r\n                                cc.scaleTo(duration / 2, 0).easing(cc.easeIn(2)),\r\n                                cc.rotateBy(duration / 2, 180),\r\n                                cc.fadeOut(duration / 2)\r\n                            ),\r\n                            cc.callFunc(() => {\r\n                                completed++;\r\n                                // :     \r\n                                if (completed === totalTiles) {\r\n                                    for (let x = 0; x < this._board.width; x++) {\r\n                                        for (let y = 0; y < this._board.height; y++) {\r\n                                            const tileView = this.getTileView(x, y);\r\n                                            const tile = this._board.getTile(x, y);\r\n                                            if (tileView && tile) {\r\n                                                tileView.node.scale = 0;\r\n                                                tileView.node.opacity = 0;\r\n                                                tileView.node.rotation = 0;\r\n                                            }\r\n                                        }\r\n                                    }\r\n\r\n                                    const allTileViews: TileView[] = [];\r\n\r\n                                    for (let x = 0; x < this._board.width; x++) {\r\n                                        for (let y = 0; y < this._board.height; y++) {\r\n                                            const tileView = this.getTileView(x, y);\r\n                                            if (tileView) {\r\n                                                allTileViews.push(tileView);\r\n                                            }\r\n                                        }\r\n                                    }\r\n\r\n                                    let completedAppear = 0;\r\n                                    const appearDuration = 0.5;\r\n\r\n                                    for (const tileView of allTileViews) {\r\n                                        const randomDelay = Math.random() * 0.3;\r\n\r\n                                        tileView.node.runAction(\r\n                                            cc.sequence(\r\n                                                cc.delayTime(randomDelay),\r\n                                                cc.spawn(\r\n                                                    cc.scaleTo(appearDuration / 2, 1.0).easing(cc.easeBackOut()),\r\n                                                    cc.fadeIn(appearDuration / 2)\r\n                                                ),\r\n                                                cc.callFunc(() => {\r\n                                                    completedAppear++;\r\n                                                    if (completedAppear === allTileViews.length) {\r\n                                                        resolve();\r\n                                                    }\r\n                                                })\r\n                                            )\r\n                                        );\r\n                                    }\r\n                                }\r\n                            })\r\n                        )\r\n                    );\r\n                }\r\n            }\r\n        });\r\n    }\r\n}","import { Tile } from \"../Tile\";\r\n\r\nexport interface TurnEffect {\r\n}\r\n\r\nexport class Board {\r\n    public tiles: Map<number, Tile>;\r\n    readonly width: number;\r\n    readonly height: number;\r\n\r\n    constructor(width: number, height: number) {\r\n        this.width = width;\r\n        this.height = height;\r\n        this.tiles = new Map();\r\n    }\r\n\r\n    public getTile(x: number, y: number): Tile | undefined {\r\n        if (!this.isValidPosition(x, y)) {\r\n            return undefined;\r\n        }\r\n        return this.tiles.get(this.getKey(x, y));\r\n    }\r\n\r\n    public setTile(x: number, y: number, tile: Tile): void {\r\n        this.validatePosition(x, y);\r\n        this.tiles.set(this.getKey(x, y), tile);\r\n    }\r\n\r\n    public swapTiles(tileA: Tile, tileB: Tile): void {\r\n        const posA = { x: tileA.x, y: tileA.y };\r\n        const posB = { x: tileB.x, y: tileB.y };\r\n\r\n        this.validatePosition(posA.x, posA.y);\r\n        this.validatePosition(posB.x, posB.y);\r\n\r\n        tileA.setPosition(posB.x, posB.y);\r\n        tileB.setPosition(posA.x, posA.y);\r\n\r\n        this.tiles.set(this.getKey(posB.x, posB.y), tileA);\r\n        this.tiles.set(this.getKey(posA.x, posA.y), tileB);\r\n    }\r\n\r\n    public removeTiles(tiles: Array<Tile>): void {\r\n        for (var tile of tiles) {\r\n            this.removeTileByPosition(tile.x, tile.y);\r\n        }\r\n    }\r\n\r\n    public removeTile(tile: Tile): void {\r\n        this.removeTileByPosition(tile.x, tile.y);\r\n    }\r\n\r\n    public removeTileByPosition(x: number, y: number): void {\r\n        if (!this.isValidPosition(x, y)) {\r\n            return;\r\n        }\r\n        this.tiles.delete(this.getKey(x, y));\r\n    }\r\n\r\n    public hasTile(x: number, y: number): boolean {\r\n        if (!this.isValidPosition(x, y)) {\r\n            return false;\r\n        }\r\n        return this.tiles.has(this.getKey(x, y));\r\n    }\r\n\r\n    public isEmpty(x: number, y: number): boolean {\r\n        const tile = this.getTile(x, y);\r\n        return !tile || tile.isEmpty;\r\n    }\r\n\r\n    public isValidPosition(x: number, y: number): boolean {\r\n        return x >= 0 && x < this.width && y >= 0 && y < this.height;\r\n    }\r\n\r\n    public getAllTiles(): Tile[] {\r\n        return Array.from(this.tiles.values());\r\n    }\r\n\r\n    public clear(): void {\r\n        this.tiles.clear();\r\n    }\r\n\r\n    private getKey(x: number, y: number): number {\r\n        return y * this.width + x;\r\n    }\r\n\r\n    private validatePosition(x: number, y: number): void {\r\n        if (!this.isValidPosition(x, y)) {\r\n            throw new Error(`Position out of bounds: (${x}, ${y}). Valid range: 0-${this.width - 1}, 0-${this.height - 1}`);\r\n        }\r\n    }\r\n}\r\n","import { GameEvent } from \"../../../GameEvent\";\r\nimport { BoosterType } from \"../../enums/BoosterType\";\r\nimport { InputState } from \"../../enums/InputState\";\r\nimport { Tile } from \"../../Tile\";\r\nimport { TurnContext } from \"../../TurnContext\";\r\nimport { Board, TurnEffect } from \"../Board\";\r\nimport { DestroyEffect } from \"../effects/DestroyEffect\";\r\nimport { Booster } from \"./Booster\";\r\n\r\nexport class BombBooster implements Booster {\r\n    public readonly type = BoosterType.BOMB;\r\n    public readonly initialInputState = InputState.BOMB;\r\n    public readonly onCountChanged = new GameEvent<number>();\r\n\r\n    private readonly _maxCount: number;\r\n    private readonly _radius: number;\r\n    private _count: number;\r\n\r\n    public constructor(count: number, radius: number) {\r\n        this._maxCount = count;\r\n        this._radius = radius;\r\n        this._count = count;\r\n    }\r\n\r\n    public canProcess(ctx: TurnContext): boolean {\r\n        return this.canUse();\r\n    }\r\n\r\n    public onTileClick(ctx: TurnContext): TurnEffect {\r\n        if (!this.canUse()) {\r\n            return [];\r\n        }\r\n\r\n        const tiles = this.getBombAffectedTiles(ctx.selectedTile, ctx.board);\r\n        for (var tile of tiles) {\r\n            ctx.tilesToRemove.add(tile);\r\n        }\r\n\r\n        this.setCount(this._count - 1);\r\n        ctx.setInputState(InputState.NORMAL);\r\n\r\n        const result: DestroyEffect = new DestroyEffect();\r\n        result.tilesToRemove = tiles;\r\n        return result;\r\n    }\r\n\r\n    public getCount(): number {\r\n        return this._count;\r\n    }\r\n\r\n    public canUse(): boolean {\r\n        return this._count > 0;\r\n    }\r\n\r\n    public reset(): void {\r\n        this.setCount(this._maxCount);\r\n    }\r\n\r\n    private getBombAffectedTiles(selectedTile: Tile, board: Board): Tile[] {\r\n        const tiles: Tile[] = [];\r\n        const radiusSq = this._radius * this._radius;\r\n\r\n        for (let dx = -this._radius; dx <= this._radius; dx++) {\r\n            for (let dy = -this._radius; dy <= this._radius; dy++) {\r\n                const distanceSq = dx * dx + dy * dy;\r\n                if (distanceSq > radiusSq) {\r\n                    continue;\r\n                }\r\n\r\n                const tile = board.getTile(selectedTile.x + dx, selectedTile.y + dy);\r\n                if (tile?.isEmpty == false) {\r\n                    tiles.push(tile);\r\n                }\r\n            }\r\n        }\r\n\r\n        return tiles;\r\n    }\r\n\r\n    private setCount(value: number) {\r\n        this._count = value;\r\n        this.onCountChanged.invoke(this._count);\r\n    }\r\n}\r\n","\r\nexport enum BoosterType {\r\n    TELEPORT = 0,\r\n    BOMB = 1,\r\n    NONE = -1\r\n}\r\n","import { BlastGame } from \"../BlastGame\";\r\nimport { BoosterType } from \"../enums/BoosterType\";\r\nimport { Boosters } from \"../mechanics/Boosters\";\r\nimport { Booster } from \"../mechanics/boosters/Booster\";\r\n\r\nconst { ccclass, property } = cc._decorator;\r\n\r\n@ccclass\r\nexport class BoosterView extends cc.Component {\r\n\r\n    @property(cc.Label)\r\n    private label: cc.Label\r\n\r\n    @property(cc.Button)\r\n    private button: cc.Button;\r\n\r\n    private _booster: Booster;\r\n    private _boosters: Boosters\r\n\r\n    private _type: BoosterType;\r\n\r\n    public get type(): BoosterType {\r\n        return this._type;\r\n    }\r\n\r\n    public init(boosters: Boosters, type: BoosterType) {\r\n        this._boosters = boosters;\r\n        this._type = type;\r\n\r\n        this._booster = this._boosters.getBooster(type);\r\n        this._booster.onCountChanged.subscribe(this.handleCountChanged, this);\r\n        boosters.onSelectedTypeChanged.subscribe(this.handleTypeChanged, this)\r\n        this.handleCountChanged(this._booster.getCount());\r\n\r\n        this.button.node.on('click', () => {\r\n            if (this._boosters.selectedType == type) {\r\n                this._boosters.apply(BoosterType.NONE);\r\n            } else if (this._boosters.canApply(type)) {\r\n                this._boosters.apply(type);\r\n            }\r\n        });\r\n    }\r\n\r\n    private handleCountChanged(value: number) {\r\n        this.label.string = this._booster.getCount().toString();\r\n        this.button.interactable = this._boosters.canApply(this.type);\r\n    }\r\n\r\n    private handleTypeChanged(type: BoosterType) {\r\n        this.animateBoosterActive(this._type == type);\r\n    }\r\n\r\n    public animateBoosterActive(active: boolean): void {\r\n        const scale = active ? 1.2 : 1.0;\r\n        const color = active ? cc.Color.YELLOW : cc.Color.WHITE;\r\n\r\n        this.node.stopAllActions();\r\n        this.node.runAction(\r\n            cc.spawn(\r\n                cc.scaleTo(0.2, scale),\r\n                cc.tintTo(0.2, color.r, color.g, color.b)\r\n            )\r\n        );\r\n\r\n        if (active) {\r\n            this.node.runAction(\r\n                cc.repeatForever(\r\n                    cc.sequence(\r\n                        cc.scaleTo(0.5, 1.3),\r\n                        cc.scaleTo(0.5, 1.2)\r\n                    )\r\n                )\r\n            );\r\n        }\r\n    }\r\n}\r\n","import { GameEvent } from \"../../GameEvent\";\r\nimport { BlastGame } from \"../BlastGame\";\r\nimport { BoosterType } from \"../enums/BoosterType\";\r\nimport { InputState } from \"../enums/InputState\";\r\nimport { TurnContext } from \"../TurnContext\";\r\nimport { TurnClickProcessor } from \"../TurnProcessor\";\r\nimport { TurnEffect } from \"./Board\";\r\nimport { Booster } from \"./boosters/Booster\";\r\n\r\nexport class Boosters implements TurnClickProcessor {\r\n    private _game: BlastGame;\r\n\r\n    private readonly _boosters = new Map<BoosterType, Booster>();\r\n\r\n    private _selectedType: BoosterType = BoosterType.NONE;\r\n\r\n    public readonly onSelectedTypeChanged = new GameEvent<BoosterType>();\r\n\r\n    public init(game: BlastGame) {\r\n        this._game = game;\r\n        this._game.onInputStateChanged.subscribe(this.handleInputStateChanged, this);\r\n    }\r\n\r\n    public get selectedType(): BoosterType {\r\n        return this._selectedType;\r\n    }\r\n\r\n    private set selectedType(type: BoosterType) {\r\n        this._selectedType = type;\r\n        this.onSelectedTypeChanged.invoke(this.selectedType);\r\n    }\r\n\r\n    public canProcess(ctx: TurnContext): boolean {\r\n        return ctx.getInputState() != InputState.NORMAL;\r\n    }\r\n\r\n    public onTileClick(ctx: TurnContext): TurnEffect | null {\r\n        const booster = this._boosters.get(this.selectedType);\r\n        if (!booster) {\r\n            return null;\r\n        }\r\n\r\n        return booster.onTileClick(ctx);\r\n    }\r\n\r\n    public getBooster(type: BoosterType): Booster {\r\n        return this._boosters.get(type);\r\n    }\r\n\r\n    public register(booster: Booster) {\r\n        this._boosters.set(booster.type, booster);\r\n    }\r\n\r\n    public reset(): void {\r\n        this.selectedType = BoosterType.NONE;\r\n        for (const booster of Array.from(this._boosters.values())) {\r\n            booster.reset();\r\n        }\r\n    }\r\n\r\n    public apply(type: BoosterType): void {\r\n        const booster = this._boosters.get(type);\r\n\r\n        if (!booster || type == BoosterType.NONE) {\r\n            this._game.setInputState(InputState.NORMAL);\r\n            return;\r\n        }\r\n\r\n        this._game.setInputState(booster.initialInputState);\r\n    }\r\n\r\n    public canApply(type: BoosterType): boolean {\r\n        if (type == BoosterType.NONE) {\r\n            return true;\r\n        }\r\n        const booster = this._boosters.get(type);\r\n        return booster?.canUse() ?? false;\r\n    }\r\n\r\n    private handleInputStateChanged(state: InputState) {\r\n        switch (state) {\r\n            case InputState.NORMAL:\r\n                this.selectedType = BoosterType.NONE;\r\n                break;\r\n            case InputState.BOMB:\r\n                this.selectedType = BoosterType.BOMB;\r\n                break\r\n            case InputState.TELEPORT_PHASE_ONE:\r\n            case InputState.TELEPORT_PHASE_TWO:\r\n                this.selectedType = BoosterType.TELEPORT;\r\n                break;\r\n        }\r\n    }\r\n}\r\n","import { BoardView } from \"./views/BoardView\";\r\nimport { BoosterView } from \"./views/BoosterView\";\r\nimport { LoseView } from \"./views/LoseView\";\r\nimport { MovesView } from \"./views/MovesView\";\r\nimport { ScoreView } from \"./views/ScoreView\";\r\nimport { WinView } from \"./views/WinView\";\r\nimport { BlastGame } from \"./BlastGame\";\r\nimport { BoosterType } from \"./enums/BoosterType\";\r\nimport { GameState } from \"./enums/GameState\";\r\nimport { OverlayView } from \"./views/OverlayView\";\r\nimport { TileViewPool } from \"./views/TileViewPool\";\r\nimport { Board } from \"./mechanics/Board\";\r\nimport { Boosters } from \"./mechanics/Boosters\";\r\nimport { Gravity } from \"./mechanics/Gravity\";\r\nimport { Matches } from \"./mechanics/Matches\";\r\nimport { Moves } from \"./mechanics/Moves\";\r\nimport { Score } from \"./mechanics/Score\";\r\nimport { Shuffle } from \"./mechanics/Shuffle\";\r\nimport { Spawner } from \"./mechanics/Spawner\";\r\nimport { SuperTiles } from \"./mechanics/superTiles/SuperTiles\";\r\nimport { BombBooster } from \"./mechanics/boosters/BombBooster\";\r\nimport { TeleportBooster } from \"./mechanics/boosters/TeleportBooster\";\r\nimport { TileColor } from \"./enums/TileColor\";\r\nimport { SuperTileType } from \"./mechanics/superTiles/SuperTileType\";\r\nimport { LineSuperTileLogic } from \"./mechanics/superTiles/LineSuperTileLogic\";\r\nimport { RadiusBombSuperTileLogic } from \"./mechanics/superTiles/RadiusBombSuperTileLogic\";\r\nimport { MaxBombSuperTileLogic } from \"./mechanics/superTiles/MaxBombSuperTileLogic\";\r\nimport { Input } from \"./mechanics/Input\";\r\nimport { GameViewController } from \"./views/GameViewController\";\r\nimport { PostGameProcessor, PostTurnProcessor, PreGameProcessor, PreTurnProcessor, TileDeletedProcessor, TurnClickProcessor } from \"./TurnProcessor\";\r\nimport { NormalClickProcessor } from \"./NormalClickProcessor\";\r\n\r\nconst { ccclass, property } = cc._decorator;\r\n\r\n@ccclass\r\nexport class Bootstrap extends cc.Component {\r\n    @property()\r\n    private boardWidth = 8;\r\n    @property()\r\n    private boardHeight = 8;\r\n\r\n    @property()\r\n    private tileSize = 110;\r\n    @property()\r\n    private tileSpacing = 2;\r\n\r\n    @property()\r\n    private scorePerTile = 10;\r\n    @property()\r\n    private targetScore = 5000;\r\n\r\n    @property()\r\n    private maxMoves = 10;\r\n\r\n    @property()\r\n    private maxShuffles = 3;\r\n\r\n    @property()\r\n    private superTileRemovedCountForLine = 5;\r\n    @property()\r\n    private superTileRemovedCountForLineRadiusBomb = 8;\r\n    @property()\r\n    private superTileRemovedCountForMaxBomb = 10;\r\n\r\n    @property()\r\n    private superTileBombRadius = 2;\r\n    @property()\r\n    private boosterBombCount = 3;\r\n    @property()\r\n    private boosterBombRadius = 2;\r\n    @property()\r\n    private boosterTeleportCount = 3;\r\n\r\n    @property(BoosterView)\r\n    private teleportView: BoosterView;\r\n\r\n    @property(BoosterView)\r\n    private bombView: BoosterView;\r\n\r\n    @property(BoardView)\r\n    private boardView: BoardView;\r\n\r\n    @property(ScoreView)\r\n    private scoreView: ScoreView;\r\n\r\n    @property(MovesView)\r\n    private movesView: MovesView;\r\n\r\n    @property(WinView)\r\n    private winView: WinView;\r\n\r\n    @property(LoseView)\r\n    private loseView: LoseView;\r\n\r\n    @property(OverlayView)\r\n    private overlayView: OverlayView;\r\n\r\n    @property(cc.Prefab)\r\n    private tilePrefab: cc.Prefab;\r\n\r\n    @property(cc.SpriteFrame)\r\n    private redTileSprite: cc.SpriteFrame;\r\n\r\n    @property(cc.SpriteFrame)\r\n    private blueTileSprite: cc.SpriteFrame;\r\n\r\n    @property(cc.SpriteFrame)\r\n    private greenTileSprite: cc.SpriteFrame;\r\n\r\n    @property(cc.SpriteFrame)\r\n    private yellowTileSprite: cc.SpriteFrame;\r\n\r\n    @property(cc.SpriteFrame)\r\n    private purpleTileSprite: cc.SpriteFrame;\r\n\r\n    @property(cc.SpriteFrame)\r\n    private horizontalTileSprite: cc.SpriteFrame;\r\n\r\n    @property(cc.SpriteFrame)\r\n    private verticalTileSprite: cc.SpriteFrame;\r\n\r\n    @property(cc.SpriteFrame)\r\n    private radiusBombTileSprite: cc.SpriteFrame;\r\n\r\n    @property(cc.SpriteFrame)\r\n    private maxBombTileSprite: cc.SpriteFrame;\r\n\r\n    protected onLoad(): void {\r\n\r\n        const boosters = new Boosters();\r\n        boosters.register(new BombBooster(this.boosterBombCount, this.boosterBombRadius));\r\n        boosters.register(new TeleportBooster(this.boosterTeleportCount));\r\n\r\n        const superTiles = new SuperTiles();\r\n        superTiles.register(new LineSuperTileLogic(true), this.superTileRemovedCountForLine);\r\n        superTiles.register(new LineSuperTileLogic(false), this.superTileRemovedCountForLine);\r\n        superTiles.register(new RadiusBombSuperTileLogic(this.superTileBombRadius), this.superTileRemovedCountForLineRadiusBomb);\r\n        superTiles.register(new MaxBombSuperTileLogic(), this.superTileRemovedCountForMaxBomb);\r\n\r\n        const spawner = new Spawner();\r\n        spawner.register(TileColor.RED);\r\n        spawner.register(TileColor.BLUE);\r\n        spawner.register(TileColor.GREEN);\r\n        spawner.register(TileColor.YELLOW);\r\n        spawner.register(TileColor.PURPLE);\r\n\r\n        const board = new Board(this.boardWidth, this.boardHeight);\r\n        const score = new Score(this.targetScore, this.scorePerTile);\r\n        const moves = new Moves(this.maxMoves);\r\n        const shuffle = new Shuffle(this.maxShuffles);\r\n        const matches = new Matches();\r\n        const gravity = new Gravity();\r\n\r\n        const input = new Input();\r\n\r\n        const preGameProcessors: Array<PreGameProcessor> = [\r\n            spawner,\r\n        ]\r\n\r\n        const postGameProcessors: Array<PostGameProcessor> = [\r\n            spawner,\r\n        ]\r\n\r\n        const preTurnProcessors: Array<PreTurnProcessor> = [\r\n            shuffle\r\n        ];\r\n\r\n        const turnClickProcessors: Array<TurnClickProcessor> = [\r\n            new NormalClickProcessor(),\r\n            boosters,\r\n            superTiles,\r\n        ];\r\n\r\n        const postTurnProcessors: Array<PostTurnProcessor> = [\r\n            gravity,\r\n            spawner,\r\n            moves,\r\n            score,\r\n        ];\r\n\r\n        const tileRemovedProcessors: Array<TileDeletedProcessor> = [\r\n\r\n        ];\r\n\r\n        const game = new BlastGame(\r\n            input,\r\n            board,\r\n            score,\r\n            moves,\r\n            spawner,\r\n            shuffle,\r\n            matches,\r\n            gravity,\r\n            superTiles,\r\n            boosters,\r\n            preGameProcessors,\r\n            postGameProcessors,\r\n            preTurnProcessors,\r\n            turnClickProcessors,\r\n            postTurnProcessors,\r\n            tileRemovedProcessors\r\n        );\r\n\r\n        this.scoreView.init(game.score);\r\n        this.movesView.init(game.moves);\r\n\r\n        this.winView.init(game);\r\n        this.loseView.init(game);\r\n\r\n        this.bombView.init(game.boosters, BoosterType.BOMB);\r\n        this.teleportView.init(game.boosters, BoosterType.TELEPORT);\r\n\r\n        const tileViewPool = new TileViewPool();\r\n        tileViewPool.init(this.tilePrefab, this.boardHeight * this.boardWidth);\r\n\r\n        tileViewPool.registerRegularTile(TileColor.RED, this.redTileSprite);\r\n        tileViewPool.registerRegularTile(TileColor.BLUE, this.blueTileSprite);\r\n        tileViewPool.registerRegularTile(TileColor.GREEN, this.greenTileSprite);\r\n        tileViewPool.registerRegularTile(TileColor.YELLOW, this.yellowTileSprite);\r\n        tileViewPool.registerRegularTile(TileColor.PURPLE, this.purpleTileSprite);\r\n\r\n        tileViewPool.registerSuperTile(SuperTileType.HORIZONTAL, this.horizontalTileSprite);\r\n        tileViewPool.registerSuperTile(SuperTileType.VERTICAL, this.verticalTileSprite);\r\n        tileViewPool.registerSuperTile(SuperTileType.RADIUS_BOMB, this.radiusBombTileSprite);\r\n        tileViewPool.registerSuperTile(SuperTileType.MAX_BOMB, this.maxBombTileSprite);\r\n\r\n        this.boardView.init(game.board, game.input, tileViewPool, this.tileSize, this.tileSpacing);\r\n\r\n        const gameView = new GameViewController(game, this.boardView, new Array<BoosterView>(this.bombView, this.teleportView), this.loseView, this.winView, this.movesView, this.scoreView, this.overlayView);\r\n        gameView.init();\r\n\r\n        game.start();\r\n    }\r\n}\r\n","import { Tile } from \"../../Tile\";\r\nimport { TurnEffect } from \"../Board\";\r\n\r\n\r\nexport class DestroyEffect implements TurnEffect {\r\n    public tilesToRemove: Array<Tile>;\r\n}\r\n","export type Handler<T> = { action: (arg1: T) => void, caller: any }\r\n\r\nexport class GameEvent<T> {\r\n    private _handlers: Handler<T>[] = [];\r\n    private _onceHandlers: Handler<T>[] = [];\r\n\r\n    public subscribe(action: (arg1: T) => void, caller: any): void {\r\n        if (this._onceHandlers.find(handler => this.same(handler, action, caller)))\r\n            throw new Error(\"Error in Event.subscribe(). Already subscribed once\");\r\n\r\n        if (this._handlers.find(handler => this.same(handler, action, caller)))\r\n            return;\r\n\r\n        this._handlers.push({ action, caller: caller });\r\n    }\r\n\r\n    public subscribeOnce(action: (arg1: T) => void, caller: any): void {\r\n        if (this._handlers.find(handler => this.same(handler, action, caller)))\r\n            throw new Error(\"Error in Event.subscribeOnce(). Already subscribed\");\r\n\r\n        if (this._onceHandlers.find(handler => this.same(handler, action, caller)))\r\n            return;\r\n\r\n        this._onceHandlers.push({ action, caller: caller });\r\n    }\r\n\r\n    public unsubscribe(action: (arg1: T) => void, caller: any): void {\r\n        const handlerIndex = this._handlers.findIndex(handler => this.same(handler, action, caller));\r\n        if (handlerIndex != -1)\r\n            this._handlers.splice(handlerIndex, 1);\r\n\r\n        const onceHandlerIndex = this._onceHandlers.findIndex(handler => this.same(handler, action, caller));\r\n        if (onceHandlerIndex != -1)\r\n            this._onceHandlers.splice(onceHandlerIndex, 1);\r\n    }\r\n\r\n    public unsubscribeAll() {\r\n        this._handlers.length = 0;\r\n        this._onceHandlers.length = 0;\r\n    }\r\n\r\n    public invoke(arg: T): void {\r\n        const handlers = [...this._handlers];\r\n        handlers.forEach((handler, i) => {\r\n            handler.action.call(handler.caller, arg);\r\n        });\r\n\r\n        const onceHandlers = [...this._onceHandlers];\r\n        onceHandlers.forEach(handler => handler.action.call(handler.caller, arg));\r\n        this._onceHandlers.length = 0;\r\n    }\r\n\r\n    private same(handler: Handler<T>, action: (arg1: T) => void, caller: any): boolean {\r\n        return handler.action == action && handler.caller == caller;\r\n    }\r\n}\r\n","\r\nexport enum GameState {\r\n    GAME = 0,\r\n    LOSE = 1,\r\n    WIN = 2\r\n}","import { BlastGame } from \"../BlastGame\";\r\nimport { BoosterType } from \"../enums/BoosterType\";\r\nimport { TurnEffect } from \"../mechanics/Board\";\r\nimport { DestroyEffect } from \"../mechanics/effects/DestroyEffect\";\r\nimport { GravityEffect } from \"../mechanics/effects/GravityEffect\";\r\nimport { LoseEffect } from \"../mechanics/effects/LoseEffect\";\r\nimport { ShakeEffect } from \"../mechanics/effects/ShakeEffect\";\r\nimport { ShuffleEffect } from \"../mechanics/effects/ShuffleEffect\";\r\nimport { SuperTileSpawnEffect } from \"../mechanics/effects/SuperTileSpawnEffect\";\r\nimport { SwapEffect } from \"../mechanics/effects/SwapEffect\";\r\nimport { TileSpawnEffect } from \"../mechanics/effects/TileSpawnEffect\";\r\nimport { WinEffect } from \"../mechanics/effects/WinEffect\";\r\nimport { Tile } from \"../Tile\";\r\nimport { BoardView } from \"./BoardView\";\r\nimport { BoosterView } from \"./BoosterView\";\r\nimport { LoseView } from \"./LoseView\";\r\nimport { MovesView } from \"./MovesView\";\r\nimport { OverlayView } from \"./OverlayView\";\r\nimport { ScoreView } from \"./ScoreView\";\r\nimport { WinView } from \"./WinView\";\r\n\r\nexport class GameViewController {\r\n    private _game: BlastGame;\r\n\r\n    private _boardView: BoardView;\r\n    private _boosterViews: Array<BoosterView>;\r\n    private _loseView: LoseView;\r\n    private _winView: WinView;\r\n    private _movesView: MovesView;\r\n    private _scoreView: ScoreView;\r\n    private _overlayView: OverlayView;\r\n\r\n    private _boosterViewsMap = new Map<BoosterType, BoosterView>();\r\n\r\n    constructor(game: BlastGame,\r\n        boardView: BoardView,\r\n        boosterViews: Array<BoosterView>,\r\n        loseView: LoseView,\r\n        winView: WinView,\r\n        movesView: MovesView,\r\n        scoreView: ScoreView,\r\n        overlayView: OverlayView,\r\n    ) {\r\n        this._game = game;\r\n        this._boardView = boardView;\r\n        this._boosterViews = boosterViews;\r\n        this._loseView = loseView;\r\n        this._winView = winView;\r\n        this._movesView = movesView;\r\n        this._scoreView = scoreView;\r\n        this._overlayView = overlayView;\r\n    }\r\n\r\n    public init() {\r\n        this._game.onGameStarted.subscribe(this.processEffects, this);\r\n        this._game.onTurnFinished.subscribe(this.processEffects, this);\r\n        this._game.onGameFinished.subscribe(this.processEffects, this);\r\n\r\n        for (var item of this._boosterViews) {\r\n            this._boosterViewsMap.set(item.type, item);\r\n        }\r\n\r\n        this._overlayView.hide(false);\r\n        this._winView.hide(false);\r\n        this._loseView.hide(false);\r\n        this._game.input.enable();\r\n        this._scoreView.updateScore(false);\r\n        this._movesView.updateMoves(false)\r\n    }\r\n\r\n    private async processEffects(effects: Array<TurnEffect>) {\r\n        this._game.input.disable();\r\n\r\n        this._overlayView.hide();\r\n        this._winView.hide();\r\n        this._loseView.hide();\r\n\r\n        for (var effect of effects) {\r\n            if (effect instanceof DestroyEffect) {\r\n                await this._boardView.animateTileRemoval(effect.tilesToRemove);\r\n            }\r\n            else if (effect instanceof SuperTileSpawnEffect) {\r\n                await this._boardView.animateSuperTileCreation(effect.superTile);\r\n            }\r\n            else if (effect instanceof TileSpawnEffect) {\r\n                await this._boardView.animateNewTiles(effect.tilesToSpawn);\r\n            }\r\n            else if (effect instanceof GravityEffect) {\r\n                await this._boardView.animateGravity(effect.moves);\r\n            }\r\n            else if (effect instanceof ShuffleEffect) {\r\n                await this._boardView.animateShuffle();\r\n            }\r\n            else if (effect instanceof ShakeEffect) {\r\n                const view = this._boardView.getTileView(effect.tileToShake.x, effect.tileToShake.y);\r\n                view.animateShake();\r\n            }\r\n            else if (effect instanceof SwapEffect) {\r\n                await this._boardView.animateTileSwap(effect.left, effect.right);\r\n            }\r\n            else if (effect instanceof WinEffect) {\r\n                await this._boardView.animateHideTiles();\r\n                await this._overlayView.show();\r\n                await this._winView.show();\r\n                this._boardView.reset();\r\n            }\r\n            else if (effect instanceof LoseEffect) {\r\n                await this._boardView.animateHideTiles();\r\n                await this._overlayView.show();\r\n                await this._loseView.show();\r\n                this._boardView.reset();\r\n            }\r\n\r\n        }\r\n\r\n        this._scoreView.updateScore();\r\n        this._movesView.updateMoves()\r\n\r\n        this._game.input.enable();\r\n    }\r\n}","import { TurnEffect } from \"../Board\";\r\nimport { TileMove } from \"../Gravity\";\r\n\r\n\r\nexport class GravityEffect implements TurnEffect {\r\n    public moves: TileMove[];\r\n}","import { TileColor } from \"../enums/TileColor\";\r\nimport { Tile } from \"../Tile\";\r\nimport { TurnContext } from \"../TurnContext\";\r\nimport { PostTurnProcessor, TurnClickProcessor } from \"../TurnProcessor\";\r\nimport { Board, TurnEffect } from \"./Board\";\r\nimport { GravityEffect } from \"./effects/GravityEffect\";\r\n\r\nexport interface TileMove {\r\n    x: number;\r\n    fromY: number;\r\n    toY: number;\r\n    tile: Tile;\r\n}\r\n\r\nexport class Gravity implements PostTurnProcessor {\r\n\r\n    public canProcess(ctx: TurnContext): boolean {\r\n        return true;\r\n    }\r\n\r\n    public onPostTurn(ctx: TurnContext): TurnEffect | null {\r\n        const moves = this.applyGravity(ctx.board);\r\n\r\n        const result: GravityEffect = new GravityEffect();\r\n        result.moves = moves;\r\n        return result;\r\n    }\r\n\r\n    public applyGravity(board: Board): Array<TileMove> {\r\n        const moveHistory = [];\r\n\r\n        for (let x = 0; x < board.width; x++) {\r\n            const tiles: Tile[] = [];\r\n\r\n            for (let y = 0; y < board.height; y++) {\r\n                const tile = board.getTile(x, y);\r\n\r\n                if (tile && !tile.isEmpty) {\r\n                    tiles.push(tile);\r\n                }\r\n            }\r\n\r\n            for (let i = 0; i < tiles.length; i++) {\r\n                const tile = tiles[i];\r\n                const oldY = tile.y;\r\n                const newY = i;\r\n\r\n                if (oldY !== newY) {\r\n                    moveHistory.push({\r\n                        x: x,\r\n                        fromY: oldY,\r\n                        toY: newY,\r\n                        tile: tile\r\n                    });\r\n                }\r\n\r\n                tile.y = newY;\r\n                board.setTile(x, newY, tile);\r\n            }\r\n\r\n            for (let y = tiles.length; y < board.height; y++) {\r\n                board.setTile(x, y, new Tile(x, y, TileColor.EMPTY));\r\n            }\r\n        }\r\n\r\n        return moveHistory;\r\n    }\r\n}\r\n","export enum InputState {\r\n    NORMAL = 0,\r\n    TELEPORT_PHASE_ONE = 1,\r\n    TELEPORT_PHASE_TWO = 2,\r\n    BOMB = 3\r\n}\r\n","import { GameEvent } from \"../../GameEvent\";\r\nimport { GameState } from \"../enums/GameState\";\r\nimport { TurnContext } from \"../TurnContext\";\r\n\r\nexport class Input {\r\n\r\n    public canProcess(ctx: TurnContext): boolean {\r\n        return ctx.getState() == GameState.GAME;\r\n    }\r\n\r\n    private _enabled: boolean = true;\r\n\r\n    public readonly onTileClicked = new GameEvent<{ x: number, y: number }>();\r\n\r\n    public invokeTileClick(pos: { x: number, y: number }) {\r\n        this.onTileClicked.invoke(pos);\r\n    }\r\n\r\n    public get isEnabled(): boolean {\r\n        return this._enabled;\r\n    }\r\n\r\n    public enable(): void {\r\n        this._enabled = true;\r\n    }\r\n\r\n    public disable(): void {\r\n        this._enabled = false;\r\n    }\r\n}\r\n","import { SuperTileType } from \"./SuperTileType\";\r\nimport { Tile } from \"../../Tile\";\r\nimport { Board, TurnEffect } from \"../Board\";\r\nimport { SuperTile } from \"./SuperTile\";\r\nimport { SuperTileLogic } from \"./SuperTileLogic\";\r\nimport { TurnContext } from \"../../TurnContext\";\r\nimport { DestroyEffect } from \"../effects/DestroyEffect\";\r\n\r\nexport class LineSuperTileLogic implements SuperTileLogic {\r\n    public readonly type: SuperTileType;\r\n\r\n    constructor(isHorizontal: boolean) {\r\n        this.type = isHorizontal ? SuperTileType.HORIZONTAL : SuperTileType.VERTICAL;\r\n    }\r\n\r\n    public canProcess(ctx: TurnContext): boolean {\r\n        return this.canProcessTile(ctx.selectedTile);\r\n    }\r\n\r\n    public canProcessTile(tile: Tile) {\r\n        return tile instanceof SuperTile && tile.type == this.type;\r\n    }\r\n\r\n    public onTileClick(ctx: TurnContext): TurnEffect | null {\r\n        const tiles = this.activate(ctx.selectedTile as SuperTile, ctx.board);\r\n\r\n        for (var tile of tiles) {\r\n            ctx.tilesToRemove.add(tile);\r\n        }\r\n\r\n        const result: DestroyEffect = new DestroyEffect();\r\n        result.tilesToRemove = tiles;\r\n        return result;\r\n    }\r\n\r\n    public activate(superTile: SuperTile, board: Board): Tile[] {\r\n        const tiles: Tile[] = [];\r\n        const range = this.type == SuperTileType.HORIZONTAL ? board.width : board.height;\r\n\r\n        for (let i = 0; i < range; i++) {\r\n            const coord1 = this.type == SuperTileType.HORIZONTAL ? i : superTile.x;\r\n            const coord2 = this.type == SuperTileType.HORIZONTAL ? superTile.y : i;\r\n\r\n            const tile = board.getTile(coord1, coord2);\r\n\r\n            if (tile && !tile.isEmpty) {\r\n                tiles.push(tile);\r\n            }\r\n        }\r\n        return tiles;\r\n    }\r\n}\r\n","\r\nexport class LoseEffect implements LoseEffect {\r\n}\r\n","\r\nimport { BlastGame } from \"../BlastGame\";\r\n\r\nconst { ccclass, property } = cc._decorator;\r\n\r\n@ccclass\r\nexport class LoseView extends cc.Component {\r\n\r\n    @property(cc.Button)\r\n    private button: cc.Button\r\n\r\n    @property(cc.Node)\r\n    private panelLose: cc.Node;\r\n\r\n    private _game: BlastGame\r\n\r\n    public init(game: BlastGame) {\r\n        this._game = game;\r\n\r\n        this.button.node.on('click', () => {\r\n            this._game.finish();\r\n            this._game.start();\r\n        })\r\n    }\r\n\r\n    public async show(animated: boolean = true) {\r\n        this.panelLose.scale = 0;\r\n        this.panelLose.active = true;\r\n        this.panelLose.runAction(\r\n            cc.spawn(\r\n                cc.scaleTo(0.3, 1),\r\n                cc.fadeIn(0.3)\r\n            )\r\n        );\r\n    }\r\n\r\n    public async hide(animated: boolean = true) {\r\n        if (animated) {\r\n            this.panelLose.stopAllActions();\r\n            this.panelLose.runAction(\r\n                cc.sequence(\r\n                    cc.spawn(\r\n                        cc.scaleTo(0.3, 0),\r\n                        cc.fadeOut(0.3)\r\n                    ),\r\n                    cc.callFunc(() => {\r\n                        this.panelLose.active = false;\r\n                        this.panelLose.opacity = 255;\r\n                    })\r\n                )\r\n            );\r\n        } else {\r\n            this.panelLose.active = false;\r\n            this.panelLose.opacity = 255;\r\n        }\r\n    }\r\n}","import { Board } from \"./Board\";\r\nimport { Tile } from \"../Tile\";\r\nimport { SuperTile } from \"./superTiles/SuperTile\";\r\n\r\nexport class Matches {\r\n    public hasAvailableMatches(board: Board): boolean {\r\n        if (this.hasSuperTile(board)) {\r\n            return true;\r\n        }\r\n\r\n        const visited: Set<number> = new Set();\r\n\r\n        for (let x = 0; x < board.width; x++) {\r\n            for (let y = 0; y < board.height; y++) {\r\n                const index = y * board.width + x;\r\n\r\n                if (visited.has(index)) {\r\n                    continue;\r\n                }\r\n\r\n                const tile = board.getTile(x, y);\r\n                if (!tile || tile.isEmpty) {\r\n                    continue;\r\n                }\r\n\r\n                const group = this.getAvaliableMatch(board, x, y);\r\n\r\n                if (group.length >= 2) {\r\n                    return true;\r\n                }\r\n\r\n                group.forEach(t => {\r\n                    const tileIndex = t.y * board.width + t.x;\r\n                    visited.add(tileIndex);\r\n                });\r\n            }\r\n        }\r\n\r\n        return false;\r\n    }\r\n\r\n    public getAvaliableMatch(board: Board, x: number, y: number): Tile[] {\r\n        const startTile = board.getTile(x, y);\r\n        if (!startTile || startTile.isEmpty) {\r\n            return [];\r\n        }\r\n\r\n        const visited: boolean[][] = Array.from({ length: board.width },\r\n            () => new Array(board.height).fill(false));\r\n\r\n        const group: Tile[] = [];\r\n        const queue: [number, number][] = [[x, y]];\r\n        const targetColor = startTile.color;\r\n        const directions = [[1, 0], [-1, 0], [0, 1], [0, -1]];\r\n\r\n        while (queue.length > 0) {\r\n            const [cx, cy] = queue.shift()!;\r\n\r\n            if (cx < 0 || cx >= board.width || cy < 0 || cy >= board.height) {\r\n                continue;\r\n            }\r\n            if (visited[cx][cy]) {\r\n                continue;\r\n            }\r\n\r\n            const tile = board.getTile(cx, cy);\r\n            if (!tile || tile.isEmpty || tile.color !== targetColor) {\r\n                continue;\r\n            }\r\n\r\n            visited[cx][cy] = true;\r\n            group.push(tile);\r\n\r\n            for (const [dx, dy] of directions) {\r\n                queue.push([cx + dx, cy + dy]);\r\n            }\r\n        }\r\n\r\n        return group.length >= 2 ? group : [];\r\n    }\r\n\r\n    private hasSuperTile(board: Board): boolean {\r\n        for (let x = 0; x < board.width; x++) {\r\n            for (let y = 0; y < board.height; y++) {\r\n                const tile = board.getTile(x, y);\r\n                if (tile instanceof SuperTile) {\r\n                    return true;\r\n                }\r\n            }\r\n        }\r\n        return false;\r\n    }\r\n}\r\n","import { SuperTileType } from \"./SuperTileType\";\r\nimport { Tile } from \"../../Tile\";\r\nimport { Board, TurnEffect } from \"../Board\";\r\nimport { SuperTile } from \"./SuperTile\";\r\nimport { SuperTileLogic } from \"./SuperTileLogic\";\r\nimport { TurnContext } from \"../../TurnContext\";\r\nimport { DestroyEffect } from \"../effects/DestroyEffect\";\r\n\r\nexport class MaxBombSuperTileLogic implements SuperTileLogic {\r\n    public readonly type = SuperTileType.MAX_BOMB;\r\n\r\n    public canProcess(ctx: TurnContext): boolean {\r\n        return ctx.selectedTile instanceof SuperTile && ctx.selectedTile.type == this.type;\r\n    }\r\n\r\n    public onTileClick(ctx: TurnContext): TurnEffect | null {\r\n        const tiles = this.activate(ctx.selectedTile as SuperTile, ctx.board);\r\n\r\n        for (var tile of tiles) {\r\n            ctx.tilesToRemove.add(tile);\r\n        }\r\n\r\n        const result: DestroyEffect = new DestroyEffect();\r\n        result.tilesToRemove = tiles;\r\n        return result;\r\n    }\r\n\r\n    public activate(superTile: SuperTile, board: Board): Tile[] {\r\n        const tiles: Tile[] = [];\r\n        for (let x = 0; x < board.width; x++) {\r\n            for (let y = 0; y < board.height; y++) {\r\n                const tile = board.getTile(x, y);\r\n                if (tile && !tile.isEmpty) {\r\n                    tiles.push(tile);\r\n                }\r\n            }\r\n        }\r\n        return tiles;\r\n    }\r\n}\r\n","import { Moves } from \"../mechanics/Moves\";\r\n\r\nconst { ccclass, property } = cc._decorator;\r\n\r\n@ccclass\r\nexport class MovesView extends cc.Component {\r\n\r\n    @property(cc.Label)\r\n    private label: cc.Label;\r\n\r\n    private _moves: Moves;\r\n    private _currentDisplayMoves: number;\r\n\r\n    public init(moves: Moves) {\r\n        this._moves = moves;\r\n        this._currentDisplayMoves = moves.currentMoves;\r\n    }\r\n\r\n    public updateMoves(animated: boolean = true): Promise<void> {\r\n        if (!animated) {\r\n            return new Promise<void>((resolve) => {\r\n                this.label.string = this.label.string = `${this._moves.currentMoves}`;\r\n                resolve();\r\n            })\r\n        }\r\n\r\n        return new Promise<void>((resolve) => {\r\n            if (!this.label) {\r\n                resolve();\r\n                return;\r\n            }\r\n\r\n            if (this._currentDisplayMoves == this._moves.currentMoves) {\r\n                this._currentDisplayMoves = this._moves.currentMoves;\r\n                this.label.string = `${this._moves.currentMoves}`;\r\n                resolve();\r\n                return;\r\n            }\r\n\r\n            const oldMoves = this._currentDisplayMoves;\r\n            const newMoves = this._moves.currentMoves;\r\n            const difference = newMoves - oldMoves;\r\n\r\n            if (difference === 0) {\r\n                resolve();\r\n                return;\r\n            }\r\n\r\n            this.label.node.stopActionByTag(101);\r\n\r\n            this._currentDisplayMoves = newMoves;\r\n            this.label.string = `${this._currentDisplayMoves}`;\r\n\r\n            let visualAction: cc.Action;\r\n\r\n            if (difference < 0) {\r\n                visualAction = cc.sequence(\r\n                    cc.spawn(\r\n                        cc.scaleTo(0.15, 1.2).easing(cc.easeOut(2)),\r\n                        cc.tintTo(0.15, 255, 100, 100) // \r\n                    ),\r\n                    cc.spawn(\r\n                        cc.scaleTo(0.25, 1.0).easing(cc.easeBackOut()),\r\n                        cc.tintTo(0.25, 255, 255, 255) // \r\n                    ),\r\n                    cc.callFunc(() => {\r\n                        resolve();\r\n                    })\r\n                );\r\n            } else {\r\n                visualAction = cc.sequence(\r\n                    cc.spawn(\r\n                        cc.scaleTo(0.15, 1.2).easing(cc.easeOut(2)),\r\n                        cc.tintTo(0.15, 100, 255, 100) // \r\n                    ),\r\n                    cc.spawn(\r\n                        cc.scaleTo(0.25, 1.0).easing(cc.easeBackOut()),\r\n                        cc.tintTo(0.25, 255, 255, 255)\r\n                    ),\r\n                    cc.callFunc(() => {\r\n                        resolve();\r\n                    })\r\n                );\r\n            }\r\n\r\n            visualAction.setTag(101);\r\n            this.label.node.runAction(visualAction);\r\n        });\r\n    }\r\n}","import { GameEvent } from \"../../GameEvent\";\r\nimport { GameState } from \"../enums/GameState\";\r\nimport { TurnContext } from \"../TurnContext\";\r\nimport { PostTurnProcessor } from \"../TurnProcessor\";\r\nimport { TurnEffect } from \"./Board\";\r\nimport { LoseEffect } from \"./effects/LoseEffect\";\r\n\r\nexport class Moves implements PostTurnProcessor {\r\n    public readonly maxMoves: number;\r\n\r\n    private _currentMoves: number;\r\n\r\n    public onMovesChanged: GameEvent<number> = new GameEvent<number>();\r\n\r\n    constructor(maxMoves: number) {\r\n        this._currentMoves = maxMoves;\r\n        this.maxMoves = maxMoves;\r\n    }\r\n\r\n    public get currentMoves(): number {\r\n        return this._currentMoves;\r\n    }\r\n\r\n    public canProcess(ctx: TurnContext): boolean {\r\n        return true;\r\n    }\r\n\r\n    public onPostTurn(ctx: TurnContext): TurnEffect | null {\r\n        if (ctx.initialRemovedCount > 0) {\r\n            this.decrementMove();\r\n        }\r\n\r\n        if (!this.hasMovesLeft()) {\r\n            ctx.setState(GameState.WIN);\r\n            return new LoseEffect();\r\n        }\r\n\r\n        return null;\r\n    }\r\n\r\n    public decrementMove(): void {\r\n        if (this._currentMoves > 0) {\r\n            this.currentMoves--;\r\n        }\r\n    }\r\n\r\n    public hasMovesLeft(): boolean {\r\n        return this._currentMoves > 0;\r\n    }\r\n\r\n    public reset(): void {\r\n        this.currentMoves = this.maxMoves;\r\n    }\r\n\r\n    private set currentMoves(value: number) {\r\n        this._currentMoves = value;\r\n        this.onMovesChanged?.invoke(this.currentMoves);\r\n    }\r\n}","import { InputState } from \"./enums/InputState\";\r\nimport { TurnEffect } from \"./mechanics/Board\";\r\nimport { DestroyEffect } from \"./mechanics/effects/DestroyEffect\";\r\nimport { ShakeEffect } from \"./mechanics/effects/ShakeEffect\";\r\nimport { SuperTile } from \"./mechanics/superTiles/SuperTile\";\r\nimport { TurnContext } from \"./TurnContext\";\r\nimport { TurnClickProcessor } from \"./TurnProcessor\";\r\n\r\nexport class NormalClickProcessor implements TurnClickProcessor {\r\n    public canProcess(ctx: TurnContext): boolean {\r\n        return ctx.getInputState() == InputState.NORMAL;\r\n    }\r\n\r\n    public onTileClick(ctx: TurnContext): TurnEffect | null {\r\n        const match = ctx.matches.getAvaliableMatch(ctx.board, ctx.selectedTile.x, ctx.selectedTile.y);\r\n        ctx.initialRemovedCount = match.length;\r\n\r\n        if (match.length == 0) {\r\n            const shakeEffect: ShakeEffect = new ShakeEffect();\r\n            shakeEffect.tileToShake = ctx.selectedTile;\r\n            return shakeEffect;\r\n        } else {\r\n            const toRemove = (ctx.selectedTile instanceof SuperTile)\r\n                ? [...match, ctx.selectedTile]\r\n                : [...match];\r\n\r\n            for (var tile of toRemove) {\r\n                ctx.tilesToRemove.add(tile);\r\n            }\r\n\r\n            const destroyEffect: DestroyEffect = new DestroyEffect();\r\n            destroyEffect.tilesToRemove = toRemove;\r\n            return destroyEffect;\r\n        };\r\n    }\r\n}","const { ccclass, property } = cc._decorator;\r\n\r\n@ccclass\r\nexport class OverlayView extends cc.Component {\r\n\r\n    @property(cc.Node)\r\n    private ovelay: cc.Node;\r\n\r\n    private _currentOpacity: number\r\n\r\n    protected onEnable(): void {\r\n        this._currentOpacity = this.ovelay.opacity;\r\n    }\r\n\r\n    public async show(animated: boolean = true) {\r\n        if (animated) {\r\n            this.ovelay.opacity = 0;\r\n            this.ovelay.active = true;\r\n            this.ovelay.runAction(\r\n                cc.fadeTo(0.3, this._currentOpacity)\r\n            );\r\n        } else {\r\n            this.ovelay.opacity = this._currentOpacity;\r\n        }\r\n    }\r\n\r\n    public async hide(animated: boolean = true) {\r\n        if (animated) {\r\n            this.ovelay.runAction(\r\n                cc.sequence(\r\n                    cc.fadeOut(0.3),\r\n                    cc.callFunc(() => {\r\n                        this.ovelay.active = false;\r\n                    })\r\n                )\r\n            );\r\n        } else {\r\n            this.ovelay.active = false;\r\n        }\r\n    }\r\n}\r\n","import { SuperTileType } from \"./SuperTileType\";\r\nimport { Tile } from \"../../Tile\";\r\nimport { Board, TurnEffect } from \"../Board\";\r\nimport { SuperTile } from \"./SuperTile\";\r\nimport { SuperTileLogic } from \"./SuperTileLogic\";\r\nimport { TurnContext } from \"../../TurnContext\";\r\nimport { DestroyEffect } from \"../effects/DestroyEffect\";\r\n\r\nexport class RadiusBombSuperTileLogic implements SuperTileLogic {\r\n    public readonly type = SuperTileType.RADIUS_BOMB;\r\n\r\n    private readonly _bombRadius: number;\r\n\r\n    constructor(bombRadius: number) {\r\n        this._bombRadius = bombRadius;\r\n    }\r\n\r\n    public canProcess(ctx: TurnContext): boolean {\r\n        return ctx.selectedTile instanceof SuperTile && ctx.selectedTile.type == this.type;\r\n    }\r\n\r\n    public canProcessTile(tile: Tile) {\r\n        return tile instanceof SuperTile && tile.type == this.type;\r\n    }\r\n\r\n    public onTileClick(ctx: TurnContext): TurnEffect | null {\r\n        const tiles = this.activate(ctx.selectedTile as SuperTile, ctx.board);\r\n\r\n        for (var tile of tiles) {\r\n            ctx.tilesToRemove.add(tile);\r\n        }\r\n\r\n        const result: DestroyEffect = new DestroyEffect();\r\n        result.tilesToRemove = tiles;\r\n        return result;\r\n    }\r\n\r\n    public activate(superTile: SuperTile, board: Board): Tile[] {\r\n        const tiles: Tile[] = [];\r\n        for (let dx = -this._bombRadius; dx <= this._bombRadius; dx++) {\r\n            for (let dy = -this._bombRadius; dy <= this._bombRadius; dy++) {\r\n                const distance = Math.sqrt(dx * dx + dy * dy);\r\n                if (distance <= this._bombRadius) {\r\n                    const tile = board.getTile(superTile.x + dx, superTile.y + dy);\r\n                    if (tile && !tile.isEmpty) {\r\n                        tiles.push(tile);\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        return tiles;\r\n    }\r\n}\r\n","import { Score } from \"../mechanics/Score\";\r\n\r\nconst { ccclass, property } = cc._decorator;\r\n\r\n@ccclass\r\nexport class ScoreView extends cc.Component {\r\n\r\n    @property(cc.Label)\r\n    private label: cc.Label;\r\n\r\n    private _currentDisplayScore: number\r\n    private _score: Score;\r\n\r\n    public init(game: Score) {\r\n        this._score = game;\r\n        this._currentDisplayScore = this._score.currentScore;\r\n    }\r\n\r\n    public updateScore(animated: boolean = true): Promise<void> {\r\n        if (!animated) {\r\n            return new Promise<void>((resolve) => {\r\n                this.label.string = `${this._score.currentScore}/${this._score.targetScore}`;\r\n                resolve();\r\n            })\r\n        }\r\n\r\n        return new Promise<void>((resolve) => {\r\n            if (!this.label) {\r\n                resolve();\r\n                return;\r\n            }\r\n\r\n            if (this._currentDisplayScore == this._score.currentScore) {\r\n                this._currentDisplayScore = this._score.currentScore;\r\n                this.label.string = `${this._score.currentScore}/${this._score.targetScore}`;\r\n                resolve();\r\n                return;\r\n            }\r\n\r\n            const oldScore = this._currentDisplayScore;\r\n            const newScore = this._score.currentScore;\r\n            const difference = newScore - oldScore;\r\n\r\n            if (difference === 0) {\r\n                resolve();\r\n                return;\r\n            }\r\n\r\n            this.label.node.stopActionByTag(100);\r\n\r\n            const duration = 0.5;\r\n            const steps = 20;\r\n            const increment = difference / steps;\r\n            let currentStep = 0;\r\n\r\n            const counterAction = cc.repeat(\r\n                cc.sequence(\r\n                    cc.delayTime(duration / steps),\r\n                    cc.callFunc(() => {\r\n                        currentStep++;\r\n                        this._currentDisplayScore = Math.floor(oldScore + increment * currentStep);\r\n\r\n                        if (currentStep >= steps) {\r\n                            this._currentDisplayScore = newScore;\r\n                        }\r\n\r\n                        this.label.string = `${this._currentDisplayScore}/${this._score.targetScore}`;\r\n                    })\r\n                ),\r\n                steps\r\n            );\r\n\r\n            const visualAction = cc.sequence(\r\n                cc.spawn(\r\n                    cc.scaleTo(0.2, 1.3).easing(cc.easeOut(2)),\r\n                    cc.tintTo(0.2, 255, 255, 100) //  \r\n                ),\r\n                cc.spawn(\r\n                    cc.scaleTo(0.3, 1.0).easing(cc.easeBackOut()),\r\n                    cc.tintTo(0.3, 255, 255, 255) //   \r\n                )\r\n            );\r\n\r\n            const combinedAction = cc.spawn(\r\n                counterAction,\r\n                cc.sequence(\r\n                    visualAction,\r\n                    cc.callFunc(() => {\r\n                        resolve();\r\n                    })\r\n                )\r\n            );\r\n            combinedAction.setTag(100);\r\n\r\n            this.label.node.runAction(combinedAction);\r\n        });\r\n    }\r\n}\r\n","import { GameEvent } from \"../../GameEvent\";\r\nimport { GameState } from \"../enums/GameState\";\r\nimport { TurnContext } from \"../TurnContext\";\r\nimport { PostTurnProcessor } from \"../TurnProcessor\";\r\nimport { TurnEffect } from \"./Board\";\r\nimport { WinEffect } from \"./effects/WinEffect\";\r\n\r\nexport class Score implements PostTurnProcessor {\r\n    public readonly targetScore: number;\r\n    public readonly scorePerTile: number;\r\n\r\n    private _currentScore: number;\r\n\r\n    public onScoreChanged: GameEvent<number> = new GameEvent<number>();\r\n\r\n    constructor(targetScore: number, scorePerTile: number) {\r\n        this._currentScore = 0;\r\n        this.targetScore = targetScore;\r\n        this.scorePerTile = scorePerTile;\r\n    }\r\n\r\n    public canProcess(ctx: TurnContext): boolean {\r\n        return true;\r\n    }\r\n\r\n    public onPostTurn(ctx: TurnContext): TurnEffect | null {\r\n        this.addScore(this.calculateScore(ctx.tilesToRemove.size));\r\n\r\n        if (this.hasReachedTarget()) {\r\n            ctx.setState(GameState.WIN);\r\n            return new WinEffect();\r\n        }\r\n\r\n        return null;\r\n    }\r\n\r\n    public get currentScore(): number {\r\n        return this._currentScore;\r\n    }\r\n\r\n    public calculateScore(tilesCount: number): number {\r\n        return tilesCount * tilesCount * this.scorePerTile;\r\n    }\r\n\r\n    public addScore(points: number): void {\r\n        this.currentScore += points;\r\n    }\r\n\r\n    public hasReachedTarget(): boolean {\r\n        return this._currentScore >= this.targetScore;\r\n    }\r\n\r\n    public reset(): void {\r\n        this.currentScore = 0;\r\n    }\r\n\r\n    private set currentScore(value: number) {\r\n        this._currentScore = value;\r\n        this.onScoreChanged?.invoke(this.currentScore);\r\n    }\r\n}","import { Tile } from \"../../Tile\";\r\nimport { TurnEffect } from \"../Board\";\r\n\r\n\r\nexport class ShakeEffect implements TurnEffect {\r\n    public tileToShake: Tile;\r\n}\r\n","import { Tile } from \"../../Tile\";\r\nimport { TurnEffect } from \"../Board\";\r\n\r\nexport class ShuffleEffect implements TurnEffect {\r\n    public tilesToShuffle: Array<Tile>;\r\n}","import { Board, TurnEffect } from \"./Board\";\r\nimport { Tile } from \"../Tile\";\r\nimport { PreTurnProcessor } from \"../TurnProcessor\";\r\nimport { TurnContext } from \"../TurnContext\";\r\nimport { ShuffleEffect } from \"./effects/ShuffleEffect\";\r\n\r\nexport class Shuffle implements PreTurnProcessor {\r\n    public readonly maxAttempts: number;\r\n\r\n    private _attempts: number;\r\n\r\n    public constructor(maxAttempts: number) {\r\n        this.maxAttempts = maxAttempts;\r\n        this._attempts = maxAttempts;\r\n    }\r\n\r\n    public get attempts(): number {\r\n        return this._attempts;\r\n    }\r\n\r\n    public canProcess(ctx: TurnContext): boolean {\r\n        return true;\r\n    }\r\n\r\n    public onPreTurn(ctx: TurnContext): TurnEffect | null {\r\n        this.reset();\r\n\r\n        let shuffled = false;\r\n        while (this.shuffleAvaliable() && !ctx.matches.hasAvailableMatches(ctx.board)) {\r\n            this.shuffle(ctx.board);\r\n            shuffled = true;\r\n        }\r\n\r\n        if (shuffled && ctx.matches.hasAvailableMatches(ctx.board)) {\r\n            const result: ShuffleEffect = new ShuffleEffect();\r\n            result.tilesToShuffle = ctx.board.getAllTiles();\r\n            return result;\r\n        }\r\n    }\r\n\r\n    public shuffleAvaliable() {\r\n        return this._attempts > 0;\r\n    }\r\n\r\n    public shuffle(board: Board) {\r\n        const allTiles: Tile[] = [];\r\n        for (let x = 0; x < board.width; x++) {\r\n            for (let y = 0; y < board.height; y++) {\r\n                const tile = board.getTile(x, y);\r\n                if (tile && !tile.isEmpty) {\r\n                    allTiles.push(tile);\r\n                }\r\n            }\r\n        }\r\n\r\n        for (let i = allTiles.length - 1; i > 0; i--) {\r\n            const j = Math.floor(Math.random() * (i + 1));\r\n            [allTiles[i], allTiles[j]] = [allTiles[j], allTiles[i]];\r\n        }\r\n\r\n        let index = 0;\r\n        for (let x = 0; x < board.width; x++) {\r\n            for (let y = 0; y < board.height; y++) {\r\n                if (index < allTiles.length) {\r\n                    const tile = allTiles[index];\r\n                    tile.setPosition(x, y);\r\n                    board.setTile(x, y, tile);\r\n                    index++;\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    public reset() {\r\n        this._attempts = this.maxAttempts;\r\n    }\r\n}\r\n","import { Board, TurnEffect } from \"./Board\";\r\nimport { SuperTileType } from \"./superTiles/SuperTileType\";\r\nimport { TileColor } from \"../enums/TileColor\";\r\nimport { Tile } from \"../Tile\";\r\nimport { SuperTile } from \"./superTiles/SuperTile\";\r\nimport { PostGameProcessor, PostTurnProcessor, PreGameProcessor, PreTurnProcessor } from \"../TurnProcessor\";\r\nimport { TurnContext } from \"../TurnContext\";\r\nimport { TileSpawnEffect } from \"./effects/TileSpawnEffect\";\r\nimport { BlastGame } from \"../BlastGame\";\r\n\r\nexport class Spawner implements PostTurnProcessor, PreGameProcessor, PostGameProcessor {\r\n\r\n    private avaliableColors = Array<TileColor>();\r\n\r\n    public canProcess(ctx: TurnContext): boolean {\r\n        return true;\r\n    }\r\n\r\n    public onPreGame(game: BlastGame): TurnEffect | null {\r\n        const toSpawn = this.fillWithRegularTiles(game.board);\r\n\r\n        for (var tile of toSpawn) {\r\n            game.board.setTile(tile.x, tile.y, tile);\r\n        }\r\n\r\n        const spawnEffect = new TileSpawnEffect();\r\n        spawnEffect.tilesToSpawn = toSpawn;\r\n        return spawnEffect;\r\n    }\r\n\r\n    public onPostGame(game: BlastGame) {\r\n        game.board.clear();\r\n    }\r\n\r\n    public onPostTurn(ctx: TurnContext): TurnEffect | null {\r\n        const toSpawn = this.fillWithRegularTiles(ctx.board);\r\n\r\n        for (var tile of toSpawn) {\r\n            ctx.board.setTile(tile.x, tile.y, tile);\r\n        }\r\n\r\n        const spawnEffect = new TileSpawnEffect();\r\n        spawnEffect.tilesToSpawn = toSpawn;\r\n        return spawnEffect;\r\n    }\r\n\r\n    public register(color: TileColor) {\r\n        this.avaliableColors.push(color);\r\n    }\r\n\r\n    public fillWithRegularTiles(board: Board): Array<Tile> {\r\n        const tilesUpdated = new Array<Tile>();\r\n\r\n        for (let x = 0; x < board.width; x++) {\r\n            for (let y = 0; y < board.height; y++) {\r\n                if (board.getTile(x, y) == null || board.getTile(x, y).isEmpty) {\r\n                    const tile = this.createRandomRegularTile(x, y);\r\n                    board.setTile(x, y, tile);\r\n                    tilesUpdated.push(tile);\r\n                }\r\n            }\r\n        }\r\n\r\n        return tilesUpdated;\r\n    }\r\n\r\n    public createRandomRegularTile(x: number, y: number): Tile {\r\n        const color = Math.floor(Math.random() * this.avaliableColors.length);\r\n        return new Tile(x, y, color);\r\n    }\r\n\r\n    public createSuperTile(x: number, y: number, type: SuperTileType): SuperTile {\r\n        return new SuperTile(x, y, TileColor.SPECIAL, type);\r\n    }\r\n\r\n    public createRegularTile(x: number, y: number, color: TileColor): Tile {\r\n        return new Tile(x, y, color);\r\n    }\r\n}\r\n","import { SuperTileType } from \"./SuperTileType\";\r\n\r\n\r\nexport class SuperTileFactory {\r\n    private readonly _thresholds: Array<{ threshold: number; type: SuperTileType; }> = [];\r\n\r\n    public register(type: SuperTileType, threshold: number) {\r\n        this._thresholds.push({ threshold: threshold, type: type });\r\n    }\r\n\r\n    public getType(tilesRemoved: number): SuperTileType {\r\n        const available = this._thresholds.filter(t => tilesRemoved >= t.threshold);\r\n        if (available.length == 0) {\r\n            return SuperTileType.NONE;\r\n        }\r\n\r\n        const random = Math.floor(Math.random() * available.length);\r\n        return available[random].type;\r\n    }\r\n}\r\n","import { Tile } from \"../../Tile\";\r\nimport { TurnEffect } from \"../Board\";\r\nimport { SuperTile } from \"../superTiles/SuperTile\";\r\n\r\n\r\nexport class SuperTileSpawnEffect implements TurnEffect {\r\n    public superTile: SuperTile;\r\n}\r\n","\r\nexport enum SuperTileType {\r\n    HORIZONTAL = 0,\r\n    VERTICAL = 1,\r\n    RADIUS_BOMB = 2,\r\n    MAX_BOMB = 3,\r\n    NONE = -1,\r\n}\r\n","import { Board, TurnEffect } from \"../Board\";\r\nimport { SuperTileType } from \"./SuperTileType\";\r\nimport { Tile } from \"../../Tile\";\r\nimport { SuperTile } from \"./SuperTile\";\r\nimport { SuperTileFactory } from \"./SuperTileFactory\";\r\nimport { SuperTileLogic } from \"./SuperTileLogic\";\r\nimport { PostTurnProcessor, TurnClickProcessor } from \"../../TurnProcessor\";\r\nimport { TurnContext } from \"../../TurnContext\";\r\nimport { SuperTileSpawnEffect } from \"../effects/SuperTileSpawnEffect\";\r\n\r\nexport class SuperTiles implements TurnClickProcessor {\r\n\r\n    private readonly _logics = new Map<SuperTileType, SuperTileLogic>();\r\n    private readonly _typeFactory = new SuperTileFactory();\r\n\r\n    public register(logic: SuperTileLogic, threshold: number): void {\r\n        this._logics.set(logic.type, logic);\r\n        this._typeFactory.register(logic.type, threshold);\r\n    }\r\n\r\n    public canProcess(ctx: TurnContext): boolean {\r\n        return true;\r\n    }\r\n\r\n    public onTileClick(ctx: TurnContext): TurnEffect | null {\r\n        if (ctx.selectedTile instanceof SuperTile) {\r\n            for (var logic of Array.from(this._logics.values())) {\r\n                if (logic.canProcess(ctx)) {\r\n                    return logic.onTileClick(ctx);\r\n                }\r\n            }\r\n        }\r\n        else {\r\n            const superType = this.getSuperTileType(ctx.initialRemovedCount);\r\n            if (superType == SuperTileType.NONE) {\r\n                return null;\r\n            }\r\n\r\n            ctx.tilesToRemove.delete(ctx.board.getTile(ctx.selectedTile.x, ctx.selectedTile.y));\r\n            const superTile = ctx.spawner.createSuperTile(ctx.selectedTile.x, ctx.selectedTile.y, superType);\r\n            ctx.board.setTile(ctx.selectedTile.x, ctx.selectedTile.y, superTile);\r\n\r\n            const effect: SuperTileSpawnEffect = new SuperTileSpawnEffect();\r\n            effect.superTile = superTile;\r\n            return effect;\r\n        }\r\n    }\r\n\r\n    public getSuperTileType(tilesRemoved: number): SuperTileType {\r\n        return this._typeFactory.getType(tilesRemoved);\r\n    }\r\n\r\n    public activate(superTile: SuperTile, board: Board): Tile[] {\r\n        const logic = this._logics.get(superTile.type);\r\n        return logic ? logic.activate(superTile, board) : [];\r\n    }\r\n}\r\n\r\n","import { SuperTileType } from \"./SuperTileType\";\r\nimport { TileColor } from \"../../enums/TileColor\";\r\nimport { Tile } from \"../../Tile\";\r\n\r\nexport class SuperTile extends Tile {\r\n    type: SuperTileType;\r\n\r\n    public constructor(x: number, y: number, color: TileColor, type: SuperTileType) {\r\n        super(x, y, color);\r\n        this.type = type;\r\n    }\r\n}","import { Tile } from \"../../Tile\";\r\nimport { TurnEffect } from \"../Board\";\r\n\r\nexport class SwapEffect implements TurnEffect {\r\n    left: Tile;\r\n    right: Tile;\r\n}","import { GameEvent } from \"../../../GameEvent\";\r\nimport { BoosterType } from \"../../enums/BoosterType\";\r\nimport { InputState } from \"../../enums/InputState\";\r\nimport { Tile } from \"../../Tile\";\r\nimport { TurnContext } from \"../../TurnContext\";\r\nimport { TurnEffect } from \"../Board\";\r\nimport { SwapEffect } from \"../effects/SwapEffect\";\r\nimport { Booster } from \"./Booster\";\r\n\r\nexport class TeleportBooster implements Booster {\r\n    public readonly type = BoosterType.TELEPORT;\r\n    public readonly initialInputState = InputState.TELEPORT_PHASE_ONE;\r\n    public readonly onCountChanged = new GameEvent<number>();\r\n\r\n    private readonly _maxCount: number;\r\n    private _count: number;\r\n\r\n    private _firstTile: Tile;\r\n\r\n    public constructor(count: number) {\r\n        this._maxCount = count;\r\n        this._count = count;\r\n    }\r\n\r\n    public canProcess(ctx: TurnContext): boolean {\r\n        return this.canUse();\r\n    }\r\n\r\n    public onTileClick(ctx: TurnContext): TurnEffect {\r\n        if (!this.canUse()) {\r\n            return []\r\n        };\r\n\r\n        if (!this._firstTile) {\r\n            this._firstTile = ctx.selectedTile;\r\n            ctx.setInputState(InputState.TELEPORT_PHASE_TWO);\r\n            return null;\r\n        }\r\n\r\n        ctx.board.swapTiles(this._firstTile, ctx.selectedTile);\r\n\r\n        const effect: SwapEffect = new SwapEffect();\r\n        effect.left = this._firstTile;\r\n        effect.right = ctx.selectedTile;\r\n\r\n        this._firstTile = null;\r\n        this.setCount(this._count - 1);\r\n        ctx.setInputState(InputState.NORMAL);\r\n\r\n        return effect;\r\n    }\r\n\r\n    public getCount(): number {\r\n        return this._count;\r\n    }\r\n\r\n    public canUse(): boolean {\r\n        return this._count > 0;\r\n    }\r\n\r\n    public reset(): void {\r\n        this.setCount(this._maxCount);\r\n        this._firstTile = null;\r\n    }\r\n\r\n    private setCount(value: number) {\r\n        this._count = value;\r\n        this.onCountChanged.invoke(this._count);\r\n    }\r\n}\r\n","\r\nexport enum TileColor {\r\n    RED = 0,\r\n    BLUE = 1,\r\n    GREEN = 2,\r\n    YELLOW = 3,\r\n    PURPLE = 4,\r\n    SPECIAL = 5,\r\n    EMPTY = -1\r\n}\r\n","import { Tile } from \"../../Tile\";\r\nimport { TurnEffect } from \"../Board\";\r\n\r\nexport class TileSpawnEffect implements TurnEffect {\r\n    public tilesToSpawn: Array<Tile>;\r\n}\r\n","import { SuperTileType } from \"../mechanics/superTiles/SuperTileType\";\r\nimport { TileColor } from \"../enums/TileColor\";\r\nimport { SuperTile } from \"../mechanics/superTiles/SuperTile\";\r\nimport { Tile } from \"../Tile\";\r\nimport TileView from \"./TileView\";\r\n\r\n// todo:       ,  \r\n//    -     \r\nexport class TileViewPool {\r\n    private static readonly TILES_POOL_NAME = 'TilesPool';\r\n\r\n    private pool: cc.NodePool;\r\n    private prefab: cc.Prefab;\r\n\r\n    private regularTilesSprites: Map<TileColor, cc.SpriteFrame> = new Map();\r\n    private superTilesSprites: Map<SuperTileType, cc.SpriteFrame> = new Map();\r\n\r\n    registerRegularTile(color: TileColor, sprite: cc.SpriteFrame) {\r\n        this.regularTilesSprites.set(color, sprite);\r\n    }\r\n\r\n    registerSuperTile(type: SuperTileType, sprite: cc.SpriteFrame) {\r\n        this.superTilesSprites.set(type, sprite);\r\n    }\r\n\r\n    public init(prefab: cc.Prefab, preinstantiatedCount: number) {\r\n        this.prefab = prefab;\r\n        this.pool = new cc.NodePool(TileViewPool.TILES_POOL_NAME);\r\n\r\n        for (let i = 0; i < preinstantiatedCount; i++) {\r\n            const tileView = cc.instantiate(this.prefab);\r\n            this.pool.put(tileView);\r\n        }\r\n    }\r\n\r\n    public terminate() {\r\n        this.pool.clear();\r\n    }\r\n\r\n    public get(tile: Tile): TileView {\r\n        let node = this.pool.get();\r\n        if (node == null) {\r\n            node = cc.instantiate(this.prefab);\r\n        }\r\n        const view = node.getComponent(TileView);\r\n\r\n        if (tile instanceof SuperTile) {\r\n            const sprite = this.superTilesSprites.get(tile.type);\r\n            view.setSpriteFrame(sprite);\r\n        }\r\n        else {\r\n            const sprite = this.regularTilesSprites.get(tile.color);\r\n            view.setSpriteFrame(sprite);\r\n        }\r\n\r\n        return view;\r\n    }\r\n\r\n    public put(tileView: TileView) {\r\n        this.pool.put(tileView.node);\r\n    }\r\n}\r\n","const { ccclass, property } = cc._decorator;\r\n\r\n@ccclass\r\nexport default class TileView extends cc.Component {\r\n\r\n    @property(cc.Sprite)\r\n    private sprite: cc.Sprite = null;\r\n\r\n    public setSpriteFrame(spriteFrame: cc.SpriteFrame): void {\r\n        if (spriteFrame) {\r\n            this.node.active = true;\r\n            this.sprite.spriteFrame = spriteFrame;\r\n        } else {\r\n            this.node.active = false;\r\n        }\r\n    }\r\n\r\n    public getPosition(): { x: number; y: number } {\r\n        return this.node.position;\r\n    }\r\n\r\n    public animateShake(): void {\r\n        this.node.stopActionByTag(999);\r\n\r\n        const originalPos = this.node.position.clone();\r\n        const shakeDistance = 10;\r\n        const shakeSpeed = 0.05;\r\n\r\n        const shakeAction = cc.sequence(\r\n            cc.moveBy(shakeSpeed, -shakeDistance, 0),\r\n            cc.moveBy(shakeSpeed, shakeDistance * 2, 0),\r\n            cc.moveBy(shakeSpeed, -shakeDistance * 2, 0),\r\n            cc.moveBy(shakeSpeed, shakeDistance, 0),\r\n            cc.moveTo(0, originalPos.x, originalPos.y),\r\n        );\r\n\r\n        shakeAction.setTag(999);\r\n        this.node.runAction(shakeAction);\r\n    }\r\n}\r\n","import { TileColor } from \"./enums/TileColor\";\r\n\r\nexport class Tile {\r\n    x: number;\r\n    y: number;\r\n    color: TileColor;\r\n\r\n    constructor(x: number, y: number, color: TileColor) {\r\n        this.x = x;\r\n        this.y = y;\r\n        this.color = color;\r\n    }\r\n\r\n    get isEmpty(): boolean {\r\n        return this.color == TileColor.EMPTY;\r\n    }\r\n\r\n    setPosition(x: number, y: number): void {\r\n        this.x = x;\r\n        this.y = y;\r\n    }\r\n}","import { TurnEffect } from \"../Board\";\r\n\r\n\r\nexport class WinEffect implements TurnEffect {\r\n}\r\n","import { BlastGame } from \"../BlastGame\";\r\n\r\nconst { ccclass, property } = cc._decorator;\r\n\r\n@ccclass\r\nexport class WinView extends cc.Component {\r\n\r\n    @property(cc.Button)\r\n    private button: cc.Button\r\n\r\n    @property(cc.Node)\r\n    private panelWin: cc.Node;\r\n\r\n    private _game: BlastGame\r\n\r\n    public init(game: BlastGame) {\r\n        this._game = game;\r\n\r\n        this.button.node.on('click', () => {\r\n            this._game.finish();\r\n            this._game.start();\r\n        })\r\n    }\r\n\r\n    public async show() {\r\n        this.panelWin.scale = 0;\r\n        this.panelWin.active = true;\r\n        this.panelWin.runAction(\r\n            cc.spawn(\r\n                cc.scaleTo(0.3, 1),\r\n                cc.fadeIn(0.3)\r\n            )\r\n        );\r\n    }\r\n\r\n    public async hide(animated: boolean = true) {\r\n        if (animated) {\r\n            this.panelWin.stopAllActions();\r\n            this.panelWin.runAction(\r\n                cc.sequence(\r\n                    cc.spawn(\r\n                        cc.scaleTo(0.3, 0),\r\n                        cc.fadeOut(0.3)\r\n                    ),\r\n                    cc.callFunc(() => {\r\n                        this.panelWin.active = false;\r\n                        this.panelWin.opacity = 255;\r\n                    })\r\n                )\r\n            );\r\n        } else {\r\n            this.panelWin.active = false;\r\n            this.panelWin.opacity = 255;\r\n        }\r\n    }\r\n}"],"file":"index.js"}